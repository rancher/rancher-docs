<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Communicating with Downstream User Clusters | Rancher</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ranchermanager.docs.rancher.com/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Communicating with Downstream User Clusters | Rancher"><meta data-rh="true" name="description" content="This section describes how Rancher provisions and manages the downstream user clusters that run your apps and services."><meta data-rh="true" property="og:description" content="This section describes how Rancher provisions and manages the downstream user clusters that run your apps and services."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="alternate" href="https://ranchermanager.docs.rancher.com/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters" hreflang="en"><link data-rh="true" rel="alternate" href="https://ranchermanager.docs.rancher.com/zh/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters" hreflang="zh"><link data-rh="true" rel="alternate" href="https://ranchermanager.docs.rancher.com/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://30NEY6C9UY-dsn.algolia.net" crossorigin="anonymous"><link data-rh="true" rel="canonical" href="https://ranchermanager.docs.rancher.com/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>



<link rel="search" type="application/opensearchdescription+xml" title="Rancher" href="/opensearch.xml">



<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="0f98beb0-fc4c-417d-a42e-564e2cae42d2" async></script>
<script src="/scripts/optanonwrapper.js" async></script><link rel="stylesheet" href="/assets/css/styles.b83e5a9c.css">
<link rel="preload" href="/assets/js/runtime~main.3bb12937.js" as="script">
<link rel="preload" href="/assets/js/main.5415f821.js" as="script">
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/">Latest</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters">Latest</a></li><li><a class="dropdown__link" href="/v2.8/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters">v2.8</a></li><li><a class="dropdown__link" href="/v2.7/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters">v2.7</a></li><li><a class="dropdown__link" href="/v2.6/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters">v2.6</a></li><li><a class="dropdown__link" href="/v2.5/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters">v2.5</a></li><li><a class="dropdown__link" href="/v2.0-v2.4/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters">v2.0-v2.4</a></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">简体中文</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Quick Links</a><ul class="dropdown__menu"><li><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/rancher/rancher-docs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Docs GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More from SUSE</a><ul class="dropdown__menu"><li><a href="https://www.rancher.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher">Rancher<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://elemental.docs.rancher.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__elemental">Elemental<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://fleet.rancher.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__fleet">Fleet<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://harvesterhci.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__harvester">Harvester<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://rancherdesktop.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher__desktop">Rancher Desktop<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://opensource.suse.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__suse">More Projects...<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">What is Rancher?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/overview">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/how-to-guides/new-user-guides">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/reference-guides/best-practices">Reference Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference-guides/best-practices">Best Practice Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Best Practice Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/reference-guides/rancher-manager-architecture">Rancher Architecture</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rancher Architecture&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference-guides/rancher-manager-architecture/rancher-server-and-components">Rancher Server and Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters">Communicating with Downstream User Clusters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference-guides/rancher-manager-architecture/architecture-recommendations">Architecture Recommendations</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference-guides/cluster-configuration">Cluster Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cluster Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference-guides/single-node-rancher-in-docker">Single-Node Rancher in Docker</a><button aria-label="Toggle the collapsible sidebar category &#x27;Single-Node Rancher in Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference-guides/backup-restore-configuration">Backup &amp; Restore Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Backup &amp; Restore Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference-guides/kubernetes-concepts">Kubernetes Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference-guides/monitoring-v2-configuration">Monitoring Configuration Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;Monitoring Configuration Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference-guides/prometheus-federator">Prometheus Federator</a><button aria-label="Toggle the collapsible sidebar category &#x27;Prometheus Federator&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference-guides/user-settings">User Settings</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Settings&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference-guides/cli-with-rancher">CLI with Rancher</a><button aria-label="Toggle the collapsible sidebar category &#x27;CLI with Rancher&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference-guides/rancher-cluster-tools">Cluster Tools for Logging, Monitoring, and Visibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference-guides/rancher-project-tools">Project Tools for Logging, Monitoring, and Visibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference-guides/system-tools">System Tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference-guides/rke1-template-example-yaml">RKE1 Example YAML</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference-guides/rancher-webhook">Rancher Webhook</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference-guides/rancher-security">Rancher Security Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rancher Security Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/integrations-in-rancher">Integrations in Rancher</a><button aria-label="Toggle the collapsible sidebar category &#x27;Integrations in Rancher&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/faq/general-faq">FAQ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/troubleshooting/general-troubleshooting">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/api/quickstart">Rancher Kubernetes API</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contribute-to-rancher">Contributing to Rancher</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference Guides</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/reference-guides/rancher-manager-architecture"><span itemprop="name">Rancher Architecture</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Communicating with Downstream User Clusters</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Latest</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Communicating with Downstream User Clusters</h1></header><p>This section describes how Rancher provisions and manages the downstream user clusters that run your apps and services.</p><p>The below diagram shows how the cluster controllers, cluster agents, and node agents allow Rancher to control downstream clusters.</p><figcaption>Communicating with Downstream Clusters</figcaption><p><img loading="lazy" alt="Rancher Components" src="/assets/images/rancher-architecture-cluster-controller-39be909f05f9b9a0e356df60dd00ea5e.svg" width="758" height="750" class="img_ev3q"></p><p>The following descriptions correspond to the numbers in the diagram above:</p><ol><li><a href="#1-the-authentication-proxy">The Authentication Proxy</a></li><li><a href="#2-cluster-controllers-and-cluster-agents">Cluster Controllers and Cluster Agents</a></li><li><a href="#3-node-agents">Node Agents</a></li><li><a href="#4-authorized-cluster-endpoint">Authorized Cluster Endpoint</a></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-the-authentication-proxy">1. The Authentication Proxy<a href="#1-the-authentication-proxy" class="hash-link" aria-label="Direct link to 1. The Authentication Proxy" title="Direct link to 1. The Authentication Proxy">​</a></h3><p>In this diagram, a user named Bob wants to see all pods running on a downstream user cluster called User Cluster 1. From within Rancher, he can run a <code>kubectl</code> command to see
the pods. Bob is authenticated through Rancher&#x27;s authentication proxy.</p><p>The authentication proxy forwards all Kubernetes API calls to downstream clusters. It integrates with authentication services like local authentication, Active Directory, and GitHub. On every Kubernetes API call, the authentication proxy authenticates the caller and sets the proper Kubernetes impersonation headers before forwarding the call to Kubernetes masters.</p><p>Rancher communicates with Kubernetes clusters using a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/" target="_blank" rel="noopener noreferrer">service account</a>. Each user account in Rancher correlates with an equivalent service account in the downstream cluster. Rancher uses the service account to <a href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/#user-impersonation" target="_blank" rel="noopener noreferrer">impersonate</a> the user, which provides all the permissions the user is intended to have.</p><p>By default, Rancher generates a <a href="/how-to-guides/new-user-guides/manage-clusters/access-clusters/use-kubectl-and-kubeconfig">kubeconfig file</a> that contains credentials for proxying through the Rancher server to connect to the Kubernetes API server on a downstream user cluster. The kubeconfig file (<code>kube_config_rancher-cluster.yml</code>) contains full access to the cluster.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-cluster-controllers-and-cluster-agents">2. Cluster Controllers and Cluster Agents<a href="#2-cluster-controllers-and-cluster-agents" class="hash-link" aria-label="Direct link to 2. Cluster Controllers and Cluster Agents" title="Direct link to 2. Cluster Controllers and Cluster Agents">​</a></h3><p>Each downstream user cluster has a cluster agent, which opens a tunnel to the corresponding cluster controller within the Rancher server.</p><p>There is one cluster controller and one cluster agent for each downstream cluster. Each cluster controller:</p><ul><li>Watches for resource changes in the downstream cluster</li><li>Brings the current state of the downstream cluster to the desired state</li><li>Configures access control policies to clusters and projects</li><li>Provisions clusters by calling the required Docker machine drivers and Kubernetes engines, such as RKE and GKE</li></ul><p>By default, to enable Rancher to communicate with a downstream cluster, the cluster controller connects to the cluster agent. If the cluster agent is not available, the cluster controller can connect to a <a href="#3-node-agents">node agent</a> instead.</p><p>The cluster agent, also called <code>cattle-cluster-agent</code>, is a component that runs in a downstream user cluster. It performs the following tasks:</p><ul><li>Connects to the Kubernetes API of Rancher-launched Kubernetes clusters</li><li>Manages workloads, pod creation and deployment within each cluster</li><li>Applies the roles and bindings defined in each cluster&#x27;s global policies</li><li>Communicates between the cluster and Rancher server (through a tunnel to the cluster controller) about events, stats, node info, and health</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-node-agents">3. Node Agents<a href="#3-node-agents" class="hash-link" aria-label="Direct link to 3. Node Agents" title="Direct link to 3. Node Agents">​</a></h3><p>If the cluster agent (also called <code>cattle-cluster-agent</code>) is not available, one of the node agents creates a tunnel to the cluster controller to communicate with Rancher.</p><p>The <code>cattle-node-agent</code> is deployed using a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/" target="_blank" rel="noopener noreferrer">DaemonSet</a> resource to make sure it runs on every node in a Rancher-launched Kubernetes cluster. It is used to interact with the nodes when performing cluster operations. Examples of cluster operations include upgrading the Kubernetes version and creating or restoring etcd snapshots.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-authorized-cluster-endpoint">4. Authorized Cluster Endpoint<a href="#4-authorized-cluster-endpoint" class="hash-link" aria-label="Direct link to 4. Authorized Cluster Endpoint" title="Direct link to 4. Authorized Cluster Endpoint">​</a></h3><p>An authorized cluster endpoint (ACE) allows users to connect to the Kubernetes API server of a downstream cluster without having to route their requests through the Rancher authentication proxy.</p><blockquote><p>ACE is available on RKE, RKE2, and K3s clusters that are provisioned or registered with Rancher. It&#x27;s not available on  clusters in a hosted Kubernetes provider, such as Amazon&#x27;s EKS.</p></blockquote><p>There are two main reasons why a user might need the authorized cluster endpoint:</p><ul><li>To access a downstream user cluster while Rancher is down</li><li>To reduce latency in situations where the Rancher server and downstream cluster are separated by a long distance</li></ul><p>The <code>kube-api-auth</code> microservice is deployed to provide the user authentication functionality for the authorized cluster endpoint. When you access the user cluster using <code>kubectl</code>, the cluster&#x27;s Kubernetes API server authenticates you by using the <code>kube-api-auth</code> service as a webhook.</p><p>Like the authorized cluster endpoint, the <code>kube-api-auth</code> authentication service is also only available for Rancher-launched Kubernetes clusters.</p><blockquote><p><strong>Example scenario:</strong> Let&#x27;s say that the Rancher server is located in the United States, and User Cluster 1 is located in Australia. A user, Alice, also lives in Australia. Alice can manipulate resources in User Cluster 1 by using the Rancher UI, but her requests will have to be sent from Australia to the Rancher server in the United States, then be proxied back to Australia, where the downstream user cluster is. The geographical distance may cause significant latency, which Alice can reduce by using the authorized cluster endpoint.</p></blockquote><p>With this endpoint enabled for the downstream cluster, Rancher generates an extra Kubernetes context in the kubeconfig file in order to connect directly to the cluster. This file has the credentials for <code>kubectl</code> and <code>helm</code>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>To use the ACE context in your kubeconfig, run <code>kubectl use-context &lt;ace context name&gt;</code> after enabling it.</p></div></div><p>For more information, refer to the section on accessing your cluster with <a href="/how-to-guides/new-user-guides/manage-clusters/access-clusters/use-kubectl-and-kubeconfig">kubectl and the kubeconfig file</a>.</p><p>We recommend exporting the kubeconfig file so that if Rancher goes down, you can still use the credentials in the file to access your cluster.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="impersonation">Impersonation<a href="#impersonation" class="hash-link" aria-label="Direct link to Impersonation" title="Direct link to Impersonation">​</a></h2><p>Users technically exist only on the upstream cluster. Rancher creates <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#rolebinding-and-clusterrolebinding" target="_blank" rel="noopener noreferrer">RoleBindings and ClusterRoleBindings</a> that refer to Rancher users, even though there is <a href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/#users-in-kubernetes" target="_blank" rel="noopener noreferrer">no actual User resource</a> on the downstream cluster.</p><p>When users interact with a downstream cluster through the authentication proxy, there needs to be some entity downstream to serve as the actor for those requests. Rancher creates service accounts to be that entity. Each service account is only granted one permission, which is to <strong>impersonate</strong> the user they belong to. If there was only one service account that could impersonate any user, then it would be possible for a malicious user to corrupt that account and escalate their privileges by impersonating another user. This issue was the basis for a <a href="https://github.com/rancher/rancher/security/advisories/GHSA-pvxj-25m6-7vqr" target="_blank" rel="noopener noreferrer">CVE</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="impersonation-troubleshooting">Impersonation Troubleshooting<a href="#impersonation-troubleshooting" class="hash-link" aria-label="Direct link to Impersonation Troubleshooting" title="Direct link to Impersonation Troubleshooting">​</a></h3><p>On the downstream cluster, five resources handle impersonation:</p><ul><li>namespace: <code>cattle-impersonation-system</code></li><li>service account: <code>cattle-impersonation-system/cattle-impersonation-&lt;user ID&gt;</code></li><li>account token secret: <code>cattle-impersonation-system/cattle-impersonation-&lt;user ID&gt;-token-&lt;hash&gt;</code></li><li>cluster role: <code>cattle-impersonation-&lt;user ID&gt;</code></li><li>cluster role binding: <code>cattle-impersonation-&lt;user ID&gt;</code></li></ul><p>In this example of a typical impersonation cluster role, the system is configured to use <code>github</code> as the auth provider:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ClusterRole</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">creationTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2021-10-06T18:20:13Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token key atrule">authz.cluster.cattle.io/impersonator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token key atrule">cattle.io/creator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> norman</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cattle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">impersonation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">abcde</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">resourceVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;3528&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">uid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> a7478731</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">72a0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">4343</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">b09f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">c3bf12552d77</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># allowed to impersonate user user-abcde</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">apiGroups</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">resourceNames</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">abcde</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> users</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">verbs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> impersonate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># allowed to impersonate listed groups</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">apiGroups</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">resourceNames</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> github_team</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//123 </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># group from GitHub auth provider</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">authenticated </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># automatic group from Kubernetes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">cattle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">authenticated </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># automatic group from Rancher</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> groups</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">verbs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> impersonate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># allowed to impersonate principal ID github_user://098</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">apiGroups</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> authentication.k8s.io</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">resourceNames</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> github_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//098 </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># principal ID from GitHub auth provider</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> userextras/principalid</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">verbs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> impersonate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># allowed to impersonate username example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">apiGroups</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> authentication.k8s.io</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">resourceNames</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> example </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># username from GitHub auth provider</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> userextras/username</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">verbs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> impersonate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you troubleshoot impersonation issues, check whether these resources exist for the user, and whether the rules in the cluster role look similar to the above. For example:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl --namespace cattle-impersonation-system get serviceaccount cattle-impersonation-</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">user ID</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl --namespace cattle-impersonation-system get secret cattle-impersonation-</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">user ID</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">-token-</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">hash</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get clusterrole cattle-impersonation-</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">user ID</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> --output yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get clusterrolebinding cattle-impersonation-</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">user ID</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you see an error related to &quot;impersonation&quot; in the UI, pay close attention to the <em>end</em> of the error message, which should indicate the real reason that the request failed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="important-files">Important Files<a href="#important-files" class="hash-link" aria-label="Direct link to Important Files" title="Direct link to Important Files">​</a></h2><p>The files mentioned below are needed to maintain, troubleshoot and upgrade your cluster:</p><ul><li><code>rancher-cluster.yml</code>: The RKE cluster configuration file.</li><li><code>kube_config_rancher-cluster.yml</code>: The Kubeconfig file for the cluster, this file contains credentials for full access to the cluster. You can use this file to authenticate with a Rancher-launched Kubernetes cluster if Rancher goes down.</li><li><code>rancher-cluster.rkestate</code>: The Kubernetes cluster state file. This file contains credentials for full access to the cluster. Note: This state file is only created when using RKE v0.2.0 or higher.</li></ul><blockquote><p><strong>Note:</strong> The &quot;rancher-cluster&quot; parts of the two latter file names are dependent on how you name the RKE cluster configuration file.</p></blockquote><p>For more information on connecting to a cluster without the Rancher authentication proxy and other configuration options, refer to the <a href="/how-to-guides/new-user-guides/manage-clusters/access-clusters/use-kubectl-and-kubeconfig">kubeconfig file</a> documentation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tools-for-provisioning-kubernetes-clusters">Tools for Provisioning Kubernetes Clusters<a href="#tools-for-provisioning-kubernetes-clusters" class="hash-link" aria-label="Direct link to Tools for Provisioning Kubernetes Clusters" title="Direct link to Tools for Provisioning Kubernetes Clusters">​</a></h2><p>The tools that Rancher uses to provision downstream user clusters depends on the type of cluster that is being provisioned.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rancher-launched-kubernetes-for-nodes-hosted-in-an-infrastructure-provider">Rancher Launched Kubernetes for Nodes Hosted in an Infrastructure Provider<a href="#rancher-launched-kubernetes-for-nodes-hosted-in-an-infrastructure-provider" class="hash-link" aria-label="Direct link to Rancher Launched Kubernetes for Nodes Hosted in an Infrastructure Provider" title="Direct link to Rancher Launched Kubernetes for Nodes Hosted in an Infrastructure Provider">​</a></h3><p>Rancher can dynamically provision nodes in a provider such as Amazon EC2, DigitalOcean, Azure, or vSphere, then install Kubernetes on them.</p><p>Rancher provisions this type of cluster using <a href="https://github.com/rancher/rke" target="_blank" rel="noopener noreferrer">RKE</a> and <a href="https://github.com/rancher/machine" target="_blank" rel="noopener noreferrer">docker-machine.</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rancher-launched-kubernetes-for-custom-nodes">Rancher Launched Kubernetes for Custom Nodes<a href="#rancher-launched-kubernetes-for-custom-nodes" class="hash-link" aria-label="Direct link to Rancher Launched Kubernetes for Custom Nodes" title="Direct link to Rancher Launched Kubernetes for Custom Nodes">​</a></h3><p>When setting up this type of cluster, Rancher installs Kubernetes on existing nodes, which creates a custom cluster.</p><p>Rancher provisions this type of cluster using <a href="https://github.com/rancher/rke" target="_blank" rel="noopener noreferrer">RKE.</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hosted-kubernetes-providers">Hosted Kubernetes Providers<a href="#hosted-kubernetes-providers" class="hash-link" aria-label="Direct link to Hosted Kubernetes Providers" title="Direct link to Hosted Kubernetes Providers">​</a></h3><p>When setting up this type of cluster, Kubernetes is installed by providers such as Google Kubernetes Engine, Amazon Elastic Container Service for Kubernetes, or Azure Kubernetes Service.</p><p>Rancher provisions this type of cluster using <a href="https://github.com/rancher/kontainer-engine" target="_blank" rel="noopener noreferrer">kontainer-engine.</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imported-kubernetes-clusters">Imported Kubernetes Clusters<a href="#imported-kubernetes-clusters" class="hash-link" aria-label="Direct link to Imported Kubernetes Clusters" title="Direct link to Imported Kubernetes Clusters">​</a></h3><p>In this type of cluster, Rancher connects to a Kubernetes cluster that has already been set up. Therefore, Rancher does not provision Kubernetes, but only sets up the Rancher agents to communicate with the cluster.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rancher-server-components-and-source-code">Rancher Server Components and Source Code<a href="#rancher-server-components-and-source-code" class="hash-link" aria-label="Direct link to Rancher Server Components and Source Code" title="Direct link to Rancher Server Components and Source Code">​</a></h2><p>This diagram shows each component that the Rancher server is composed of:</p><p><img loading="lazy" alt="Rancher Components" src="/assets/images/rancher-architecture-rancher-components-64200c35eda5939f425c67f5a498f96f.svg" width="647" height="276" class="img_ev3q"></p><p>The GitHub repositories for Rancher can be found at the following links:</p><ul><li><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer">Main Rancher server repository</a></li><li><a href="https://github.com/rancher/ui" target="_blank" rel="noopener noreferrer">Rancher UI</a></li><li><a href="https://github.com/rancher/api-ui" target="_blank" rel="noopener noreferrer">Rancher API UI</a></li><li><a href="https://github.com/rancher/norman" target="_blank" rel="noopener noreferrer">Norman,</a> Rancher&#x27;s API framework</li><li><a href="https://github.com/rancher/types" target="_blank" rel="noopener noreferrer">Types</a></li><li><a href="https://github.com/rancher/cli" target="_blank" rel="noopener noreferrer">Rancher CLI</a></li><li><a href="https://github.com/rancher/helm" target="_blank" rel="noopener noreferrer">Catalog applications</a></li></ul><p>This is a partial list of the most important Rancher repositories. For more details about Rancher source code, refer to the section on <a href="/contribute-to-rancher#rancher-repositories">contributing to Rancher.</a> To see all libraries and projects used in Rancher, see the <a href="https://github.com/rancher/rancher/blob/master/go.mod" target="_blank" rel="noopener noreferrer"><code>go.mod</code> file</a> in the <code>rancher/rancher</code> repository.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rancher-docs/edit/main/docs/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-10-20T22:19:38.000Z">Oct 20, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/reference-guides/rancher-manager-architecture/rancher-server-and-components"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Rancher Server and Components</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/reference-guides/rancher-manager-architecture/architecture-recommendations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Architecture Recommendations</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-the-authentication-proxy" class="table-of-contents__link toc-highlight">1. The Authentication Proxy</a></li><li><a href="#2-cluster-controllers-and-cluster-agents" class="table-of-contents__link toc-highlight">2. Cluster Controllers and Cluster Agents</a></li><li><a href="#3-node-agents" class="table-of-contents__link toc-highlight">3. Node Agents</a></li><li><a href="#4-authorized-cluster-endpoint" class="table-of-contents__link toc-highlight">4. Authorized Cluster Endpoint</a></li><li><a href="#impersonation" class="table-of-contents__link toc-highlight">Impersonation</a><ul><li><a href="#impersonation-troubleshooting" class="table-of-contents__link toc-highlight">Impersonation Troubleshooting</a></li></ul></li><li><a href="#important-files" class="table-of-contents__link toc-highlight">Important Files</a></li><li><a href="#tools-for-provisioning-kubernetes-clusters" class="table-of-contents__link toc-highlight">Tools for Provisioning Kubernetes Clusters</a><ul><li><a href="#rancher-launched-kubernetes-for-nodes-hosted-in-an-infrastructure-provider" class="table-of-contents__link toc-highlight">Rancher Launched Kubernetes for Nodes Hosted in an Infrastructure Provider</a></li><li><a href="#rancher-launched-kubernetes-for-custom-nodes" class="table-of-contents__link toc-highlight">Rancher Launched Kubernetes for Custom Nodes</a></li><li><a href="#hosted-kubernetes-providers" class="table-of-contents__link toc-highlight">Hosted Kubernetes Providers</a></li><li><a href="#imported-kubernetes-clusters" class="table-of-contents__link toc-highlight">Imported Kubernetes Clusters</a></li></ul></li><li><a href="#rancher-server-components-and-source-code" class="table-of-contents__link toc-highlight">Rancher Server Components and Source Code</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3bb12937.js"></script>
<script src="/assets/js/main.5415f821.js"></script>
</body>
</html>