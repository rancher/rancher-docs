<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-2.9 plugin-docs plugin-id-default docs-doc-id-integrations-in-rancher/monitoring-and-alerting/how-monitoring-works" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Monitoring 的工作原理 | Rancher</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ranchermanager.docs.rancher.com/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="2.9"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.9"><meta data-rh="true" name="docsearch:version" content="2.9"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.9"><meta data-rh="true" property="og:title" content="Monitoring 的工作原理 | Rancher"><meta data-rh="true" name="description" content="1. 架构概述"><meta data-rh="true" property="og:description" content="1. 架构概述"><link data-rh="true" rel="icon" href="/zh/img/favicon.png"><link data-rh="true" rel="canonical" href="https://ranchermanager.docs.rancher.com/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works"><link data-rh="true" rel="alternate" href="https://ranchermanager.docs.rancher.com/v2.9/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works" hreflang="en"><link data-rh="true" rel="alternate" href="https://ranchermanager.docs.rancher.com/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works" hreflang="zh"><link data-rh="true" rel="alternate" href="https://ranchermanager.docs.rancher.com/v2.9/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://30NEY6C9UY-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>



<link rel="search" type="application/opensearchdescription+xml" title="Rancher" href="/zh/opensearch.xml">



<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="0f98beb0-fc4c-417d-a42e-564e2cae42d2" async></script>
<script src="/scripts/optanonwrapper.js" async></script><link rel="stylesheet" href="/zh/assets/css/styles.29ec6351.css">
<link rel="preload" href="/zh/assets/js/runtime~main.cf90f180.js" as="script">
<link rel="preload" href="/zh/assets/js/main.e239ef0f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/v2.9">v2.9 (Preview)</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works">Latest</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works">v2.9 (Preview)</a></li><li><a class="dropdown__link" href="/zh/v2.8/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works">v2.8</a></li><li><a class="dropdown__link" href="/zh/v2.7/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works">v2.7</a></li><li><a class="dropdown__link" href="/zh/v2.6/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works">v2.6</a></li><li><a class="dropdown__link" href="/zh/v2.5">v2.5</a></li><li><a class="dropdown__link" href="/zh/v2.0-v2.4">v2.0-v2.4</a></li><li><a class="dropdown__link" href="/zh/versions">All versions</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/v2.9/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Quick Links</a><ul class="dropdown__menu"><li><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/rancher/rancher-docs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Docs GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More from SUSE</a><ul class="dropdown__menu"><li><a href="https://www.rancher.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher">Rancher<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://elemental.docs.rancher.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__elemental">Elemental<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://fleet.rancher.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__fleet">Fleet<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://harvesterhci.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__harvester">Harvester<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://rancherdesktop.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher__desktop">Rancher Desktop<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://opensource.suse.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__suse">More Projects...<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v2.9">什么是 Rancher？</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.9/getting-started/overview">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.9/how-to-guides/new-user-guides">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.9/reference-guides/best-practices">Reference Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zh/v2.9/integrations-in-rancher">Integrations in Rancher</a><button aria-label="打开/收起侧边栏菜单「Integrations in Rancher」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.9/integrations-in-rancher/kubernetes-distributions">Kubernetes 发行版</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.9/integrations-in-rancher/harvester">Virtualization on Kubernetes with Harvester</a><button aria-label="打开/收起侧边栏菜单「Virtualization on Kubernetes with Harvester」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.9/integrations-in-rancher/longhorn">Cloud Native Storage with Longhorn</a><button aria-label="打开/收起侧边栏菜单「Cloud Native Storage with Longhorn」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.9/integrations-in-rancher/neuvector">Container Security with Neuvector</a><button aria-label="打开/收起侧边栏菜单「Container Security with Neuvector」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.9/integrations-in-rancher/kubewarden">使用 Kubewarden 进行高级策略管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.9/integrations-in-rancher/elemental">使用 Elemental 进行操作系统管理</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.9/integrations-in-rancher/fleet">Continuous Delivery with Fleet</a><button aria-label="打开/收起侧边栏菜单「Continuous Delivery with Fleet」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.9/integrations-in-rancher/rancher-desktop">桌面上的 Kubernetes 与 Rancher Desktop</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.9/integrations-in-rancher/cloud-marketplace">Cloud Marketplace Integration</a><button aria-label="打开/收起侧边栏菜单「Cloud Marketplace Integration」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.9/integrations-in-rancher/cluster-api">Cluster API (CAPI) with Rancher Turtles</a><button aria-label="打开/收起侧边栏菜单「Cluster API (CAPI) with Rancher Turtles」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.9/integrations-in-rancher/cis-scans">CIS Scans</a><button aria-label="打开/收起侧边栏菜单「CIS Scans」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.9/integrations-in-rancher/istio">Istio</a><button aria-label="打开/收起侧边栏菜单「Istio」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.9/integrations-in-rancher/logging">Logging</a><button aria-label="打开/收起侧边栏菜单「Logging」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting">Monitoring and Alerting</a><button aria-label="打开/收起侧边栏菜单「Monitoring and Alerting」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works">Monitoring 的工作原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring">RBAC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/built-in-dashboards">内置仪表板</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/windows-support">Monitoring V2 的 Windows 集群支持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/promql-expressions">PromQL 表达式参考</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.9/integrations-in-rancher/opa-gatekeeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.9/integrations-in-rancher/rancher-extensions">Rancher 扩展</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.9/faq/general-faq">FAQ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.9/troubleshooting/general-troubleshooting">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.9/api/quickstart">Rancher Kubernetes API</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v2.9/contribute-to-rancher">参与 Rancher 社区贡献</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>此为 <!-- -->Rancher<!-- --> <b>v2.9 (Preview)</b> 版尚未发行的文档。</div><div class="margin-top--md">最新的文档请参阅<b><a href="/zh/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works">最新版本</a></b> (<!-- -->Latest<!-- -->)。</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/v2.9/integrations-in-rancher"><span itemprop="name">Integrations in Rancher</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting"><span itemprop="name">Monitoring and Alerting</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Monitoring 的工作原理</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：v2.9 (Preview)</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Monitoring 的工作原理</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-架构概述">1. 架构概述<a href="#1-架构概述" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p><em><strong>下文描述了数据如何流经 Monitoring V2 应用程序：</strong></em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prometheus-operator">Prometheus Operator<a href="#prometheus-operator" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Prometheus Operator 观察正在创建的 ServiceMonitors、PodMonitors 和 PrometheusRules。在创建 Prometheus 配置资源时，Prometheus Operator 会调用 Prometheus API 来同步新配置。如本节末尾的图所示，Prometheus Operator 充当 Prometheus 和 Kubernetes 之间的中介，调用 Prometheus API 来同步 Prometheus 与 Kubernetes 中的监控相关资源。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="servicemonitor-和-podmonitor">ServiceMonitor 和 PodMonitor<a href="#servicemonitor-和-podmonitor" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>ServiceMonitor 和 PodMonitor 以声明方式指定需要监控的目标，例如 Service 和 Pod。</p><ul><li><p>目标是根据配置的 Prometheus 抓取间隔定期抓取的，而抓取的指标存储在 Prometheus 时间序列数据库（Time Series Database，TSDB）中。</p></li><li><p>为了执行抓取，你需要使用标签选择器来定义 ServiceMonitor 和 PodMonitor，这些标签选择器用于确定要抓取的 Service 或 Pod，并能确定端点（端点能确定抓取如何在给定目标上进行，例如在 TCP 10252 中抓取指标，通过 IP 地址 x.x.x.x 进行代理）。</p></li><li><p>开箱即用地，Monitoring V2 附带了一些预配置的 Exporter，这些 Exporter 根据其所在的 Kubernetes 集群的类型进行部署。有关详细信息，请参阅<a href="#5-%E6%8A%93%E5%8F%96%E5%92%8C%E5%85%AC%E5%BC%80%E6%8C%87%E6%A0%87">抓取和公开指标</a>。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pushprox-的工作原理">PushProx 的工作原理<a href="#pushprox-的工作原理" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><ul><li><p>某些内部 Kubernetes 组件是通过部署在 Monitoring V2 中名为 <strong>PushProx</strong> 的代理来抓取的。通过 PushProx 向 Prometheus 公开指标的 Kubernetes 组件分别是 <code>kube-controller-manager</code>、<code>kube-scheduler</code>, <code>etcd</code> 和 <code>kube-proxy</code>。</p></li><li><p>对于每个 PushProx Exporter，我们在所有目标节点上都部署一个 PushProx 客户端。例如，将 PushProx 客户端部署到 kube-controller-manager 的所有 controlplane 节点、kube-etcd 的所有 etcd 节点上，和 kubelet 的所有节点上。</p></li><li><p>我们为每个 Exporter 部署了一个 PushProx 代理。导出指标的流程如下：</p></li></ul><ol><li>PushProx 客户端与 PushProx 代理建立出站连接。</li><li>然后，客户端会轮询代理以获取进入代理的抓取请求。</li><li>当代理收到来自 Prometheus 的抓取请求时，客户端会将其视为轮询的结果。</li><li>客户端抓取内部组件。</li><li>内部组件通过将指标推回代理来响应。</li></ol><figcaption><br>使用 PushProx 导出指标的过程：<br></figcaption><p><img loading="lazy" alt="使用 PushProx 导出指标的过程" src="/zh/assets/images/pushprox-process-55d88db60b9b3bc052a693a41774df74.svg" width="821" height="612" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prometheusrules">PrometheusRules<a href="#prometheusrules" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>PrometheusRule 用于定义指标或时间序列数据库查询触发告警的规则。规则是按时间间隔评估的。</p><ul><li><strong>记录规则</strong>根据已收集的现有序列创建一个新的时间序列。它们常用于预先计算的复杂查询。</li><li><strong>告警规则</strong>运行特定查询，如果查询评估为非零值，则从 Prometheus 触发告警。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="告警路由">告警路由<a href="#告警路由" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>一旦 Prometheus 确定需要触发告警，就会将告警转发到 <strong>Alertmanager</strong>。</p><ul><li><p>告警包含来自 PromQL 查询本身的标签，以及指定初始 PrometheusRule 时设置的其他标签和注释。</p></li><li><p>在接收任何告警之前，Alertmanager 会用配置中指定的<strong>路由 (Route)</strong> 和<strong>接收器 (Receiver)</strong> 来形成一个路由树，所有传入的告警都会在该路由树上进行评估。路由树的每个节点都可以根据附加到 Prometheus 告警的标签来指定要进行的其他分组、标签和过滤。路由树上的节点（通常是叶节点）还可以指定到达的告警需要发送到什么接收器，例如 Slack、PagerDuty、SMS 等。请注意，Alertmanager 首先向 <strong>alertingDriver</strong> 发送告警，然后 alertingDriver 再将告警发送或转发到正确的目标位置。</p></li><li><p>路由和接收器也通过 Alertmanager Secret 存储在 Kubernetes API 中。当 Secret 更新时，Alertmanager 也会自动更新。请注意，路由仅通过标签发生（而不是通过注释等）。</p></li></ul><figcaption>数据如何流经 Monitoring 应用程序</figcaption><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-prometheus-的工作原理">2. Prometheus 的工作原理<a href="#2-prometheus-的工作原理" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="存储时间序列数据">存储时间序列数据<a href="#存储时间序列数据" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>收集 Exporter 的指标后，Prometheus 将时间序列存储在本地磁盘时间序列数据库中。Prometheus 可以选择与远程系统集成，但 <code>rancher-monitoring</code> 使用本地存储来存储时间序列数据库。</p><p>存储后，用户可以使用 PromQL（Prometheus 的查询语言）查询此 TSDB。</p><p>PromQL 查询可以通过以下两种方式进行可视化：</p><ol><li>通过在 Prometheus 的 Graph UI 中提供查询，UI 会显示数据的简单图形视图。</li><li>通过创建包含 PromQL 查询和其他格式化指令的 Grafana 仪表板，这些指令用于标记轴、添加单位、更改颜色、使用替代可视化等。</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="为-prometheus-定义规则">为 Prometheus 定义规则<a href="#为-prometheus-定义规则" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>规则定义了 Prometheus 需要在常规 <code>evaluationInterval</code> 上执行的查询，从而执行某些操作，例如触发告警（告警规则）或根据 TSDB 中存在的其他查询（记录规则）预先计算查询。这些规则编码在 PrometheusRules 自定义资源中。创建或更新 PrometheusRule 自定义资源后，Prometheus Operator 会观察变化，并调用 Prometheus API 来定期同步 Prometheus 当前正在评估的规则集。</p><p>PrometheusRule 支持定义一个或多个 RuleGroup。每个 RuleGroup 由一组 Rule 对象组成，每个 Rule 对象均能表示告警或记录规则，并具有以下字段：</p><ul><li>新告警或记录的名称</li><li>新告警或记录的 PromQL 表达式</li><li>用于标记告警或记录的标签（例如集群名称或严重性）</li><li>对需要在告警通知上显示的其他重要信息进行编码的注释（例如摘要、描述、消息、Runbook URL 等）。记录规则不需要此字段。</li></ul><p>在评估<a href="https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/api.md#rule" target="_blank" rel="noopener noreferrer">规则</a>时，Prometheus 将执行配置的 PromQL 查询，添加其他标签（或注释 - 仅用于告警规则），并为规则执行所需的操作。例如，如果某个告警规则将 <code>team:front-end</code> 作为标签添加到配置的 PromQL 查询，该标签会尾附到触发的告警，这将允许 Alertmanager 将告警转发到正确的接收器。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="告警和记录规则">告警和记录规则<a href="#告警和记录规则" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Prometheus 不会维护告警是否处于 active 状态。它在每个评估间隔内重复触发告警，并根据 Alertmanager 对告警进行分组和过滤成有意义的通知。</p><p><code>evaluation_interval</code> 常量定义了 Prometheus 根据时间序列数据库评估告警规则的频率。与 <code>scrape_interval</code> 类似，<code>evaluation_interval</code> 的默认值也是一分钟。</p><p>规则包含在一组规则文件中。规则文件包括告警规则和记录规则，但只有告警规则才会在评估后触发告警。</p><p>对于记录规则，Prometheus 会运行查询，然后将其存储为时间序列。如果需要存储非常昂贵或耗时的查询的结果，这种合成的时间序列则非常有用，因此你可以在后续更快地进行查询它们。</p><p>告警规则是更常用的。每当告警规则评估为正数时，Prometheus 都会触发告警。</p><p>在触发告警之前，Rule 文件会根据实际用例将标签和注释添加到告警中：</p><ul><li><p>标签用于标识告警的信息，并可能影响告警的路由。例如，如果在发送有关某个容器的告警时，你可以使用容器 ID 作为标签。</p></li><li><p>注释用于表示不影响告警路由位置的信息，例如 Runbook 或错误消息。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-alertmanager-的工作原理">3. Alertmanager 的工作原理<a href="#3-alertmanager-的工作原理" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>Alertmanager 处理由 Prometheus server 等客户端应用发送的告警。它负责以下任务：</p><ul><li><p>删除重复数据，分组，并将告警路由到正确的接收器集成（例如电子邮件、PagerDuty 或 OpsGenie）</p></li><li><p>静音和抑制告警</p></li><li><p>跟踪随时间触发的告警</p></li><li><p>发送告警的状态，即告警是否正在触发，或者是否已经解决</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="由-alertingdrivers-转发的告警">由 alertingDrivers 转发的告警<a href="#由-alertingdrivers-转发的告警" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>安装 alertingDriver 后会根据 alertingDriver 的配置创建一个 <code>Service</code>，可用作 Teams 或 SMS 的接收器 URL。接收器中的 URL 会指向 alertingDrivers。因此 Alertmanager 首先向 alertingDriver 发送告警，然后 alertingDriver 将告警转发或发送到正确的目的位置。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="将告警路由到接收器">将告警路由到接收器<a href="#将告警路由到接收器" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Alertmanager 负责协调告警的发送位置。它允许你根据标签对告警进行分组，并根据标签匹配情况来触发告警。一个最顶层路由会接受所有告警。然后，Alertmanager 会根据告警是否匹配下一个路由的条件，继续将告警路由到接收器。</p><p>虽然 Rancher UI 表单只允许编辑两层深的路由树，但你可以通过编辑 Alertmanager Secret 来配置更深的嵌套路由结构。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置多个接收器">配置多个接收器<a href="#配置多个接收器" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>你可以编辑 Rancher UI 中的表单来设置一个接收器资源，其中包含 Alertmanager 将告警发送到你的通知系统所需的所有信息。</p><p>通过在 Alertmanager 或接收器配置中编辑自定义 YAML，你还可以将告警发送到多个通知系统。有关详细信息，请参阅<a href="/zh/v2.9/reference-guides/monitoring-v2-configuration/receivers#%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AA%E6%8E%A5%E6%94%B6%E5%99%A8">接收器配置</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-monitoring-v2-特定组件">4. Monitoring V2 特定组件<a href="#4-monitoring-v2-特定组件" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>Prometheus Operator 引入了一组<a href="https://github.com/prometheus-operator/prometheus-operator#customresourcedefinitions" target="_blank" rel="noopener noreferrer">自定义资源定义</a>，允许用户通过在集群上创建和修改这些自定义资源来部署和管理 Prometheus 和 Alertmanager 实例。</p><p>Prometheus Operator 会根据 Rancher UI 中编辑的资源和配置选项的实时状态来自动更新 Prometheus 配置。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="默认部署的资源">默认部署的资源<a href="#默认部署的资源" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>默认情况下，由 <a href="https://github.com/prometheus-operator/kube-prometheus" target="_blank" rel="noopener noreferrer">kube-prometheus</a> 项目策划的一组资源会作为 Rancher Monitoring 安装的一部分部署到你的集群上，用来设置基本的 Monitoring/Alerting 堆栈。</p><p>你可以在 <a href="https://github.com/rancher/charts/tree/main/charts/rancher-monitoring" target="_blank" rel="noopener noreferrer"><code>rancher-monitoring</code></a> Helm Chart 中找到部署到你的集群以支持此解决方案的资源，该 chart 密切跟踪由 Prometheus 社区维护的上游 <a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack" target="_blank" rel="noopener noreferrer">kube-prometheus-stack</a> Helm Chart，并在 <a href="https://github.com/rancher/charts/blob/main/charts/rancher-monitoring/CHANGELOG.md" target="_blank" rel="noopener noreferrer">CHANGELOG.md</a> 中跟踪变更。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="默认-exporter">默认 Exporter<a href="#默认-exporter" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Monitoring V2 部署了三个默认 Exporter，它们为 Prometheus 提供额外的指标来存储：</p><ol><li><p><code>node-exporter</code>：公开 Linux 主机的硬件和操作系统指标。有关 <code>node-exporter</code> 的更多信息，请参阅<a href="https://prometheus.io/docs/guides/node-exporter/" target="_blank" rel="noopener noreferrer">上游文档</a>。</p></li><li><p><code>windows-exporter</code>：公开 Windows 主机的硬件和操作系统指标（仅部署在 Windows 集群上）。有关 <code>windows-exporter</code> 的更多信息，请参阅<a href="https://github.com/prometheus-community/windows_exporter" target="_blank" rel="noopener noreferrer">上游文档</a>。</p></li><li><p><code>kube-state-metrics</code>：公开跟踪 Kubernetes API 中包含的资源状态的其他指标（例如，pod、工作负载等）。有关 <code>kube-state-metrics</code> 的更多信息，请参阅<a href="https://github.com/kubernetes/kube-state-metrics/tree/master/docs" target="_blank" rel="noopener noreferrer">上游文档</a>。</p></li></ol><p>ServiceMonitor 和 PodMonitor 将按照<a href="#%E5%AE%9A%E4%B9%89%E8%A6%81%E6%8A%93%E5%8F%96%E7%9A%84%E6%8C%87%E6%A0%87">此定义</a>来抓取这些 Exporter。Prometheus 会存储这些指标，你可以通过 Prometheus 的 UI 或 Grafana 查询结果。</p><p>有关记录规则、告警规则和 Alertmanager 的更多信息，请参阅<a href="#1-%E6%9E%B6%E6%9E%84%E6%A6%82%E8%BF%B0">架构</a>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rancher-ui-中公开的组件">Rancher UI 中公开的组件<a href="#rancher-ui-中公开的组件" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>安装 monitoring 应用后，你将能够在 Rancher UI 中编辑以下组件：</p><table><thead><tr><th>组件</th><th>组件类型</th><th>编辑的目的和常见用例</th></tr></thead><tbody><tr><td>ServiceMonitor</td><td>自定义资源</td><td>设置 Kubernetes Service 来获取其自定义指标。自动更新 Prometheus 自定义资源中的抓取配置。</td></tr><tr><td>PodMonitor</td><td>自定义资源</td><td>设置 Kubernetes Pod 来获取其自定义指标。自动更新 Prometheus 自定义资源中的抓取配置。</td></tr><tr><td>接收器</td><td>配置块（Alertmanager 的一部分）</td><td>修改将告警发送到什么位置的信息（例如，Slack、PagerDuty 等）以及发送告警的其他必要信息（例如，TL​​S 证书、代理 URL 等）。自动更新 Alertmanager 自定义资源。</td></tr><tr><td>Route</td><td>配置块（Alertmanager 的一部分）</td><td>修改用于根据标签过滤、标记和分组告警的路由树，并将告警发送到所需的接收器。自动更新 Alertmanager 自定义资源。</td></tr><tr><td>PrometheusRule</td><td>自定义资源</td><td>定义其他查询，这些查询能触发告警或定义 Prometheus TSDB 中现有的物化视图。自动更新 Prometheus 自定义资源。</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pushprox">PushProx<a href="#pushprox" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>PushProx 允许 Prometheus 跨网络边界抓取指标，这样，用户就不用必须为 Kubernetes 集群中每个节点上的内部 Kubernetes 组件公开指标端口。</p><p>由于 Kubernetes 组件的指标通常暴露在集群中节点的主机网络上，PushProx 部署了一个客户端 DaemonSet，这些客户端位于每个节点的主机网络上，并与位于 Kubernetes API 上的单个代理建立出站连接。然后，你可以让 Prometheus 通过代理将抓取请求发送到每个客户端，这样，Prometheus 能从内部 Kubernetes 组件抓取指标，而不需要打开任何入站节点端口。</p><p>有关更多信息，请参阅<a href="#%E4%BD%BF%E7%94%A8-pushprox-%E6%8A%93%E5%8F%96%E6%8C%87%E6%A0%87">使用 PushProx 抓取指标</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-抓取和公开指标">5. 抓取和公开指标<a href="#5-抓取和公开指标" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="定义要抓取的指标">定义要抓取的指标<a href="#定义要抓取的指标" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>ServiceMonitor 和 PodMonitor 定义了 Prometheus 要抓取的目标。<a href="https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/design.md#prometheus" target="_blank" rel="noopener noreferrer">Prometheus 自定义资源</a>告诉 Prometheus 应该使用哪个 ServiceMonitor 或 PodMonitor 来确定从哪里抓取指标。</p><p>Prometheus Operator 观察 ServiceMonitor 和 PodMonitor。当它观察到二者被创建或更新时，它会调用 Prometheus API 来更新 Prometheus 自定义资源中的抓取配置，并使该配置与 ServiceMonitor 或 PodMonitor 中的抓取配置保持同步。此抓取配置告诉 Prometheus 从哪些端点抓取指标，以及如何标记这些端点的指标。</p><p>Prometheus 会根据 <code>scrape_interval</code>（默认为一分钟）来抓取定义在抓取配置中的所有指标。</p><p>抓取配置可以作为 Prometheus 自定义资源的一部分被查看，该资源在 Rancher UI 中公开。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prometheus-operator-如何设置指标抓取">Prometheus Operator 如何设置指标抓取<a href="#prometheus-operator-如何设置指标抓取" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Prometheus Deployment 或 StatefulSet 能抓取指标，而 Prometheus 的配置由 Prometheus 自定义资源控制。Prometheus Operator 会观察 Prometheus 和 Alertmanager 资源，当它们被创建时，Prometheus Operator 使用用户定义的配置，为 Prometheus 或 Alertmanager 创建一个 Deployment 或 StatefulSet。</p><p>如果 Prometheus Operator 观察到正在创建的 ServiceMonitor、PodMonitor 和 PrometheusRule，它就知道需要在 Prometheus 中更新抓取配置。首先，会通过更新 Prometheus 的 Deployment 或 StatefulSet 卷中的配置和规则文件来更新 Prometheus。然后，再调用 Prometheus API 来同步新配置，从而将 Prometheus Deployment 或 StatefulSet 修改到位。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何公开-kubernetes-组件指标">如何公开 Kubernetes 组件指标<a href="#如何公开-kubernetes-组件指标" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Prometheus 从称为 <a href="https://prometheus.io/docs/instrumenting/exporters/" target="_blank" rel="noopener noreferrer">exporter</a> 的 deployment 中抓取指标，exporter 以 Prometheus 可以抓取的格式导出时间序列数据。在 Prometheus 中，时间序列由属于相同指标和相同标记维度集的时间戳值流组成。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-pushprox-抓取指标">使用 PushProx 抓取指标<a href="#使用-pushprox-抓取指标" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>某些内部 Kubernetes 组件是通过部署在 Monitoring V2 中名为 PushProx 的代理来抓取的。有关 PushProx 的详细信息，请参阅<a href="#pushprox-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">此处</a>和上面的<a href="#1-%E6%9E%B6%E6%9E%84%E6%A6%82%E8%BF%B0">架构</a>部分。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="抓取指标">抓取指标<a href="#抓取指标" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Prometheus 直接抓取以下 Kubernetes 组件：</p><ul><li>kubelet<!-- -->*</li><li>ingress-nginx<!-- -->*<!-- -->*</li><li>coreDns/kubeDns</li><li>kube-api-server</li></ul><p>*<!-- --> 你可以选择通过 <code>hardenedKubelet.enabled</code> 来使用 PushProx，但这不是默认设置。</p><p>*<!-- -->*<!-- --> RKE 和 RKE2 集群默认部署 ingress-nginx，并将其视为内部 Kubernetes 组件。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="基于-kubernetes-发行版抓取指标">基于 Kubernetes 发行版抓取指标<a href="#基于-kubernetes-发行版抓取指标" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>指标的抓取方式根据 Kubernetes 发行版而有所不同。有关术语的帮助，请参阅<a href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A">此处</a>。详情见下表：</p><figcaption>指标如何暴露给 Prometheus</figcaption><table><thead><tr><th>Kubernetes 组件</th><th>RKE</th><th>RKE2</th><th>KubeADM</th><th>K3s</th></tr></thead><tbody><tr><td>kube-controller-manager</td><td>rkeControllerManager.enabled</td><td>rke2ControllerManager.enabled</td><td>kubeAdmControllerManager.enabled</td><td>k3sServer.enabled</td></tr><tr><td>kube-scheduler</td><td>rkeScheduler.enabled</td><td>rke2Scheduler.enabled</td><td>kubeAdmScheduler.enabled</td><td>k3sServer.enabled</td></tr><tr><td>etcd</td><td>rkeEtcd.enabled</td><td>rke2Etcd.enabled</td><td>kubeAdmEtcd.enabled</td><td>不可用</td></tr><tr><td>kube-proxy</td><td>rkeProxy.enabled</td><td>rke2Proxy.enabled</td><td>kubeAdmProxy.enabled</td><td>k3sServer.enabled</td></tr><tr><td>kubelet</td><td>收集 kubelet 直接公开的指标</td><td>收集 kubelet 直接公开的指标</td><td>收集 kubelet 直接公开的指标</td><td>收集 kubelet 直接公开的指标</td></tr><tr><td>ingress-nginx*</td><td>收集 kubelet 直接公开的指标，由 rkeIngressNginx.enabled 公开</td><td>收集 kubelet 直接公开的指标，由 rke2IngressNginx.enabled 公开</td><td>不可用</td><td>不可用</td></tr><tr><td>coreDns/kubeDns</td><td>收集 coreDns/kubeDns 直接公开的指标</td><td>收集 coreDns/kubeDns 直接公开的指标</td><td>收集 coreDns/kubeDns 直接公开的指标</td><td>收集 coreDns/kubeDns 直接公开的指标</td></tr><tr><td>kube-api-server</td><td>收集 kube-api-server 直接公开的指标</td><td>收集 kube-api-server 直接公开的指标</td><td>收集 kube-appi-server 直接公开的指标</td><td>收集 kube-api-server 直接公开的指标</td></tr></tbody></table><p>*<!-- --> RKE 和 RKE2 集群默认部署 ingress-nginx，并将其视为内部 Kubernetes 组件。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="名词解释">名词解释<a href="#名词解释" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><ul><li><strong>kube-scheduler</strong>：内部 Kubernetes 组件，该组件使用 pod 规范中的信息来决定在哪个节点上运行 pod。</li><li><strong>kube-controller-manager</strong>：负责节点管理（检测节点是否失败）、pod 复制，以及端点创建的内部 Kubernetes 组件。</li><li><strong>etcd</strong>：Kubernetes 内部组件，它是 Kubernetes 用于持久存储所有集群信息的分布式键/值存储。</li><li><strong>kube-proxy</strong>：内部 Kubernetes 组件，用于监控 API server 的 pod/service 更改以保持网络最新状态。</li><li><strong>kubelet</strong>：内部 Kubernetes 组件，用于为 pod 监视节点上的 API server 并确保这些 pod 能运行。</li><li><strong>ingress-nginx</strong>：用于 Kubernetes 的 Ingress controller，使用 NGINX 作为反向代理和负载均衡器。</li><li><strong>coreDns/kubeDns</strong>：负责 DNS 的内部 Kubernetes 组件。</li><li><strong>kube-api-server</strong>：负责为其他 master 组件公开 API 的主要内部 Kubernetes 组件。</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.9/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2024-05-28T22:47:56.000Z">2024年5月28日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">监控和告警</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/v2.9/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">RBAC</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-架构概述" class="table-of-contents__link toc-highlight">1. 架构概述</a><ul><li><a href="#prometheus-operator" class="table-of-contents__link toc-highlight">Prometheus Operator</a></li><li><a href="#servicemonitor-和-podmonitor" class="table-of-contents__link toc-highlight">ServiceMonitor 和 PodMonitor</a></li><li><a href="#pushprox-的工作原理" class="table-of-contents__link toc-highlight">PushProx 的工作原理</a></li><li><a href="#prometheusrules" class="table-of-contents__link toc-highlight">PrometheusRules</a></li><li><a href="#告警路由" class="table-of-contents__link toc-highlight">告警路由</a></li></ul></li><li><a href="#2-prometheus-的工作原理" class="table-of-contents__link toc-highlight">2. Prometheus 的工作原理</a><ul><li><a href="#存储时间序列数据" class="table-of-contents__link toc-highlight">存储时间序列数据</a></li><li><a href="#为-prometheus-定义规则" class="table-of-contents__link toc-highlight">为 Prometheus 定义规则</a></li><li><a href="#告警和记录规则" class="table-of-contents__link toc-highlight">告警和记录规则</a></li></ul></li><li><a href="#3-alertmanager-的工作原理" class="table-of-contents__link toc-highlight">3. Alertmanager 的工作原理</a><ul><li><a href="#由-alertingdrivers-转发的告警" class="table-of-contents__link toc-highlight">由 alertingDrivers 转发的告警</a></li><li><a href="#将告警路由到接收器" class="table-of-contents__link toc-highlight">将告警路由到接收器</a></li><li><a href="#配置多个接收器" class="table-of-contents__link toc-highlight">配置多个接收器</a></li></ul></li><li><a href="#4-monitoring-v2-特定组件" class="table-of-contents__link toc-highlight">4. Monitoring V2 特定组件</a><ul><li><a href="#默认部署的资源" class="table-of-contents__link toc-highlight">默认部署的资源</a></li><li><a href="#默认-exporter" class="table-of-contents__link toc-highlight">默认 Exporter</a></li><li><a href="#rancher-ui-中公开的组件" class="table-of-contents__link toc-highlight">Rancher UI 中公开的组件</a></li><li><a href="#pushprox" class="table-of-contents__link toc-highlight">PushProx</a></li></ul></li><li><a href="#5-抓取和公开指标" class="table-of-contents__link toc-highlight">5. 抓取和公开指标</a><ul><li><a href="#定义要抓取的指标" class="table-of-contents__link toc-highlight">定义要抓取的指标</a></li><li><a href="#prometheus-operator-如何设置指标抓取" class="table-of-contents__link toc-highlight">Prometheus Operator 如何设置指标抓取</a></li><li><a href="#如何公开-kubernetes-组件指标" class="table-of-contents__link toc-highlight">如何公开 Kubernetes 组件指标</a></li><li><a href="#使用-pushprox-抓取指标" class="table-of-contents__link toc-highlight">使用 PushProx 抓取指标</a></li><li><a href="#抓取指标" class="table-of-contents__link toc-highlight">抓取指标</a></li><li><a href="#基于-kubernetes-发行版抓取指标" class="table-of-contents__link toc-highlight">基于 Kubernetes 发行版抓取指标</a></li><li><a href="#名词解释" class="table-of-contents__link toc-highlight">名词解释</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.cf90f180.js"></script>
<script src="/zh/assets/js/main.e239ef0f.js"></script>
</body>
</html>