"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[21583],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return p}});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),l=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=l(e.components);return r.createElement(c.Provider,{value:n},e.children)},_={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(t),p=a,m=d["".concat(c,".").concat(p)]||d[p]||_[p]||i;return t?r.createElement(m,o(o({ref:n},u),{},{components:t})):r.createElement(m,o({ref:n},u))}));function p(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=d;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=t[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},86510:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return c},default:function(){return p},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return _}});var r=t(87462),a=t(63366),i=(t(67294),t(3905)),o=["components"],s={title:"\u4f7f\u7528 CIS 1.6 Benchmark \u7684 RKE \u5f3a\u5316\u6307\u5357",weight:100,aliases:["/rancher/v2.6/en/security/hardening-guides/1.6-hardening-2.6/"]},c=void 0,l={unversionedId:"reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-hardening-guide-with-cis-v1.6-benchmark",id:"reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-hardening-guide-with-cis-v1.6-benchmark",title:"\u4f7f\u7528 CIS 1.6 Benchmark \u7684 RKE \u5f3a\u5316\u6307\u5357",description:"\u672c\u6587\u6863\u63d0\u4f9b\u4e86\u7528\u4e8e\u5f3a\u5316 RKE \u96c6\u7fa4\uff08\u4f7f\u7528 Rancher 2.6 \u8fdb\u884c\u914d\u7f6e\uff09\u751f\u4ea7\u5b89\u88c5\u7684\u8bf4\u660e\u3002\u6b64\u5904\u6982\u8ff0\u4e86\u9075\u5faa CIS \u7684 Kubernetes Benchmark \u7ba1\u63a7\u6240\u9700\u7684\u914d\u7f6e\u548c\u63a7\u5236\u3002",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-hardening-guide-with-cis-v1.6-benchmark.md",sourceDirName:"reference-guides/rancher-security/rancher-v2.6-hardening-guides",slug:"/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-hardening-guide-with-cis-v1.6-benchmark",permalink:"/zh/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-hardening-guide-with-cis-v1.6-benchmark",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/docs/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-hardening-guide-with-cis-v1.6-benchmark.md",tags:[],version:"current",lastUpdatedAt:1663710212,formattedLastUpdatedAt:"2022/9/20",frontMatter:{title:"\u4f7f\u7528 CIS 1.6 Benchmark \u7684 RKE \u5f3a\u5316\u6307\u5357",weight:100,aliases:["/rancher/v2.6/en/security/hardening-guides/1.6-hardening-2.6/"]},sidebar:"tutorialSidebar",previous:{title:"Rancher 2.6 \u7684\u81ea\u6211\u8bc4\u4f30\u548c\u5f3a\u5316\u6307\u5357",permalink:"/zh/pages-for-subheaders/rancher-v2.6-hardening-guides"},next:{title:"RKE CIS 1.6 Benchmark - \u81ea\u6211\u8bc4\u4f30\u6307\u5357 - Rancher 2.6",permalink:"/zh/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-self-assessment-guide-with-cis-v1.6-benchmark"}},u={},_=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:3},{value:"\u5df2\u77e5\u95ee\u9898",id:"\u5df2\u77e5\u95ee\u9898",level:4},{value:"\u914d\u7f6e\u5185\u6838\u8fd0\u884c\u65f6\u53c2\u6570",id:"\u914d\u7f6e\u5185\u6838\u8fd0\u884c\u65f6\u53c2\u6570",level:3},{value:"\u914d\u7f6e <code>etcd</code> \u7528\u6237\u548c\u7ec4",id:"\u914d\u7f6e-etcd-\u7528\u6237\u548c\u7ec4",level:3},{value:"\u521b\u5efa <code>etcd</code> \u7528\u6237\u548c\u7ec4",id:"\u521b\u5efa-etcd-\u7528\u6237\u548c\u7ec4",level:4},{value:"\u914d\u7f6e <code>default</code> ServiceAccount",id:"\u914d\u7f6e-default-serviceaccount",level:3},{value:"\u5c06 <code>default</code> ServiceAccount \u7684 <code>automountServiceAccountToken</code> \u8bbe\u7f6e\u4e3a <code>false</code>",id:"\u5c06-default-serviceaccount-\u7684-automountserviceaccounttoken-\u8bbe\u7f6e\u4e3a-false",level:4},{value:"\u914d\u7f6e\u7f51\u7edc\u7b56\u7565",id:"\u914d\u7f6e\u7f51\u7edc\u7b56\u7565",level:3},{value:"\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565",id:"\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565",level:4},{value:"\u5f3a\u5316 RKE <code>cluster.yml</code> \u914d\u7f6e\u53c2\u8003",id:"\u5f3a\u5316-rke-clusteryml-\u914d\u7f6e\u53c2\u8003",level:3},{value:"\u5f3a\u5316 RKE \u6a21\u677f\u914d\u7f6e\u53c2\u8003",id:"\u5f3a\u5316-rke-\u6a21\u677f\u914d\u7f6e\u53c2\u8003",level:3},{value:"\u5f3a\u5316 <code>cloud-config</code> \u914d\u7f6e\u53c2\u8003",id:"\u5f3a\u5316-cloud-config-\u914d\u7f6e\u53c2\u8003",level:3},{value:"\u9488\u5bf9 SUSE Linux Enterprise Server 15 (SLES 15) \u548c openSUSE Leap 15 \u7684\u5f3a\u5316 <strong>cloud-config</strong> \u53c2\u8003",id:"\u9488\u5bf9-suse-linux-enterprise-server-15-sles-15-\u548c-opensuse-leap-15-\u7684\u5f3a\u5316-cloud-config-\u53c2\u8003",level:4},{value:"\u9488\u5bf9 Red Hat Enterprise Linux 8 (RHEL 8) \u548c Ubuntu 20.04 LTS \u7684\u5f3a\u5316 <strong>cloud-config</strong> \u53c2\u8003",id:"\u9488\u5bf9-red-hat-enterprise-linux-8-rhel-8-\u548c-ubuntu-2004-lts-\u7684\u5f3a\u5316-cloud-config-\u53c2\u8003",level:4}],d={toc:_};function p(e){var n=e.components,t=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"\u672c\u6587\u6863\u63d0\u4f9b\u4e86\u7528\u4e8e\u5f3a\u5316 RKE \u96c6\u7fa4\uff08\u4f7f\u7528 Rancher 2.6 \u8fdb\u884c\u914d\u7f6e\uff09\u751f\u4ea7\u5b89\u88c5\u7684\u8bf4\u660e\u3002\u6b64\u5904\u6982\u8ff0\u4e86\u9075\u5faa CIS \u7684 Kubernetes Benchmark \u7ba1\u63a7\u6240\u9700\u7684\u914d\u7f6e\u548c\u63a7\u5236\u3002"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"\u672c\u5f3a\u5316\u6307\u5357\u4ecb\u7ecd\u4e86\u5982\u4f55\u4fdd\u62a4\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u3002\u5efa\u8bae\u4f60\u5728\u5b89\u88c5 Kubernetes \u4e4b\u524d\u53c2\u8003\u672c\u6307\u5357\u3002"))),(0,i.kt)("p",null,"\u672c\u5f3a\u5316\u6307\u5357\u9002\u7528\u4e8e RKE \u96c6\u7fa4\uff0c\u5e76\u5bf9\u5e94\u4ee5\u4e0b CIS Kubernetes Benchmark\u3001Kubernetes \u548c Rancher \u7248\u672c\uff1a"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Rancher \u7248\u672c"),(0,i.kt)("th",{parentName:"tr",align:null},"CIS Benchmark \u7248\u672c"),(0,i.kt)("th",{parentName:"tr",align:null},"Kubernetes \u7248\u672c"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Rancher v2.6"),(0,i.kt)("td",{parentName:"tr",align:null},"Benchmark v1.6"),(0,i.kt)("td",{parentName:"tr",align:null},"Kubernetes v1.18 \u5230 v1.23")))),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://releases.rancher.com/documents/security/2.6/Rancher_v2-6_CIS_v1-6_Hardening_Guide.pdf"},"\u70b9\u51fb\u6b64\u5904\u4e0b\u8f7d\u672c\u6587\u6863\u7684 PDF \u7248\u672c"),"\u3002"),(0,i.kt)("h3",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,i.kt)("p",null,"\u672c\u6587\u6863\u4ecb\u7ecd\u4e86\u5f3a\u5316 RKE \u96c6\u7fa4\u7684\u8bf4\u660e\uff0c\u8be5\u96c6\u7fa4\u4f7f\u7528 Kubernetes 1.18 \u81f3 1.23 \u7248\u672c\u5b89\u88c5 Rancher 2.6\uff0c\u6216\u5728 Rancher 2.6 \u4e2d\u914d\u7f6e\u4f7f\u7528 Kubernetes 1.18 \u81f3 1.23 \u7248\u672c\u7684 RKE \u96c6\u7fa4\u3002\u6b64\u5904\u6982\u8ff0\u4e86\u9075\u5faa CIS \u7684 Kubernetes Benchmark \u7ba1\u63a7\u6240\u9700\u7684\u914d\u7f6e\u3002"),(0,i.kt)("p",null,"\u6709\u5173\u6839\u636e\u5b98\u65b9 CIS Benchmark \u8bc4\u4f30\u5f3a\u5316\u96c6\u7fa4\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 ",(0,i.kt)("a",{parentName:"p",href:"/zh/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-self-assessment-guide-with-cis-v1.6-benchmark"},"CIS 1.6 Benchmark - \u81ea\u6211\u8bc4\u4f30\u6307\u5357 - Rancher 2.6"),"\u3002"),(0,i.kt)("h4",{id:"\u5df2\u77e5\u95ee\u9898"},"\u5df2\u77e5\u95ee\u9898"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u6ce8\u518c\u81ea\u5b9a\u4e49\u8282\u70b9\u65f6\u4ec5\u63d0\u4f9b\u516c\u5171 IP\uff0cCIS 1.6 \u5f3a\u5316\u8bbe\u7f6e\u4e2d\u7528\u4e8e Pod \u7684 Rancher ",(0,i.kt)("strong",{parentName:"li"},"exec shell")," \u548c ",(0,i.kt)("strong",{parentName:"li"},"view logs")," \u5c06",(0,i.kt)("strong",{parentName:"li"},"\u4e0d\u8d77\u4f5c\u7528"),"\u3002\u6b64\u529f\u80fd\u8981\u6c42\u5728\u6ce8\u518c\u81ea\u5b9a\u4e49\u8282\u70b9\u65f6\u63d0\u4f9b\u79c1\u6709 IP\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u628a ",(0,i.kt)("inlineCode",{parentName:"li"},"default_pod_security_policy_template_id:")," \u8bbe\u7f6e\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"restricted")," \u6216 ",(0,i.kt)("inlineCode",{parentName:"li"},"restricted-noroot"),"\uff0c\u6839\u636e Rancher \u63d0\u4f9b\u7684 ",(0,i.kt)("a",{parentName:"li",href:"/zh/how-to-guides/advanced-user-guides/authentication-permissions-and-global-configuration/create-pod-security-policies"},"Pod \u5b89\u5168\u7b56\u7565 (PSP)"),"\uff0cRancher \u4f1a\u5728\u9ed8\u8ba4 ServiceAccount \u4e0a\u521b\u5efa ",(0,i.kt)("strong",{parentName:"li"},"RoleBindings")," \u548c ",(0,i.kt)("strong",{parentName:"li"},"ClusterRoleBindings"),"\u3002CIS 1.6 \u68c0\u67e5 5.1.5 \u65f6\u4f1a\u8981\u6c42\u9ed8\u8ba4 ServiceAccount \u9664\u4e86\u9ed8\u8ba4\u503c\u4e4b\u5916\u6ca1\u6709\u7ed1\u5b9a\u5230\u5176\u4ed6\u89d2\u8272\u6216\u96c6\u7fa4\u89d2\u8272\u3002\u6b64\u5916\uff0c\u4f60\u8fd8\u9700\u8981\u914d\u7f6e\u9ed8\u8ba4 ServiceAccount\uff0c\u4f7f\u5176\u4e0d\u63d0\u4f9b ServiceAccount \u4ee4\u724c\u5e76\u4e14\u6ca1\u6709\u663e\u5f0f\u5206\u914d\u4efb\u4f55\u6743\u9650\u3002")),(0,i.kt)("h3",{id:"\u914d\u7f6e\u5185\u6838\u8fd0\u884c\u65f6\u53c2\u6570"},"\u914d\u7f6e\u5185\u6838\u8fd0\u884c\u65f6\u53c2\u6570"),(0,i.kt)("p",null,"\u5efa\u8bae\u4e3a\u96c6\u7fa4\u4e2d\u6240\u6709\u7c7b\u578b\u7684\u8282\u70b9\u4f7f\u7528\u4ee5\u4e0b ",(0,i.kt)("inlineCode",{parentName:"p"},"sysctl")," \u914d\u7f6e\u3002\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/sysctl.d/90-kubelet.conf")," \u4e2d\u8bbe\u7f6e\u5982\u4e0b\u53c2\u6570\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ini"},"vm.overcommit_memory=1\nvm.panic_on_oom=0\nkernel.panic=10\nkernel.panic_on_oops=1\nkernel.keys.root_maxbytes=25000000\n")),(0,i.kt)("p",null,"\u8fd0\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"sysctl -p /etc/sysctl.d/90-kubelet.conf")," \u4ee5\u542f\u7528\u8bbe\u7f6e\u3002"),(0,i.kt)("h3",{id:"\u914d\u7f6e-etcd-\u7528\u6237\u548c\u7ec4"},"\u914d\u7f6e ",(0,i.kt)("inlineCode",{parentName:"h3"},"etcd")," \u7528\u6237\u548c\u7ec4"),(0,i.kt)("p",null,"\u5728\u5b89\u88c5 RKE \u4e4b\u524d\uff0c\u4f60\u9700\u8981\u8bbe\u7f6e ",(0,i.kt)("strong",{parentName:"p"},"etcd")," \u670d\u52a1\u7684\u7528\u6237\u8d26\u53f7\u548c\u7ec4\u3002\u5728\u5b89\u88c5\u671f\u95f4\uff0c",(0,i.kt)("strong",{parentName:"p"},"etcd")," \u7528\u6237\u7684 ",(0,i.kt)("strong",{parentName:"p"},"uid")," \u548c ",(0,i.kt)("strong",{parentName:"p"},"gid")," \u5c06\u7528\u4e8e\u5728 RKE ",(0,i.kt)("strong",{parentName:"p"},"config.yml")," \u4e2d\u8bbe\u7f6e\u9002\u5f53\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u6743\u9650\u3002"),(0,i.kt)("h4",{id:"\u521b\u5efa-etcd-\u7528\u6237\u548c\u7ec4"},"\u521b\u5efa ",(0,i.kt)("inlineCode",{parentName:"h4"},"etcd")," \u7528\u6237\u548c\u7ec4"),(0,i.kt)("p",null,"\u8981\u521b\u5efa ",(0,i.kt)("strong",{parentName:"p"},"etcd")," \u7528\u6237\u548c\u7ec4\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u63a7\u5236\u53f0\u547d\u4ee4\u3002\u4e0b\u9762\u7684\u547d\u4ee4\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"52034")," \u4f5c\u4e3a ",(0,i.kt)("strong",{parentName:"p"},"uid")," \u548c ",(0,i.kt)("strong",{parentName:"p"},"gid"),"\u3002\u8be5\u503c\u53ea\u662f\u4e00\u4e2a\u793a\u4f8b\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u6709\u6548\u4e14\u672a\u88ab\u4f7f\u7528\u7684 ",(0,i.kt)("strong",{parentName:"p"},"uid")," \u6216 ",(0,i.kt)("strong",{parentName:"p"},"gid")," \u6765\u4ee3\u66ff ",(0,i.kt)("inlineCode",{parentName:"p"},"52034"),"\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'groupadd --gid 52034 etcd\nuseradd --comment "etcd service account" --uid 52034 --gid 52034 etcd --shell /usr/sbin/nologin\n')),(0,i.kt)("p",null,"\u4f7f\u7528 ",(0,i.kt)("strong",{parentName:"p"},"etcd")," \u7528\u6237\u7684 ",(0,i.kt)("strong",{parentName:"p"},"uid")," \u548c ",(0,i.kt)("strong",{parentName:"p"},"gid")," \u6765\u66f4\u65b0 RKE ",(0,i.kt)("strong",{parentName:"p"},"config.yml"),"\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"services:\n  etcd:\n    gid: 52034\n    uid: 52034\n")),(0,i.kt)("h3",{id:"\u914d\u7f6e-default-serviceaccount"},"\u914d\u7f6e ",(0,i.kt)("inlineCode",{parentName:"h3"},"default")," ServiceAccount"),(0,i.kt)("h4",{id:"\u5c06-default-serviceaccount-\u7684-automountserviceaccounttoken-\u8bbe\u7f6e\u4e3a-false"},"\u5c06 ",(0,i.kt)("inlineCode",{parentName:"h4"},"default")," ServiceAccount \u7684 ",(0,i.kt)("inlineCode",{parentName:"h4"},"automountServiceAccountToken")," \u8bbe\u7f6e\u4e3a ",(0,i.kt)("inlineCode",{parentName:"h4"},"false")),(0,i.kt)("p",null,"Kubernetes \u4e3a\u96c6\u7fa4\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u4e86\u4e00\u4e2a default ServiceAccount\uff0c\u4f46\u6ca1\u6709\u4e3a pod \u5206\u914d\u7279\u5b9a ServiceAccount\u3002\u5982\u679c\u9700\u8981\u4ece pod \u8bbf\u95ee Kubernetes API\uff0c\u5219\u9700\u8981\u4e3a\u8be5 pod \u521b\u5efa\u4e00\u4e2a\u7279\u5b9a\u7684 ServiceAccount \u5e76\u6388\u4e88\u6743\u9650\u3002\u4f60\u8fd8\u9700\u8981\u914d\u7f6e default  ServiceAccount\uff0c\u4f7f\u5176\u4e0d\u63d0\u4f9b ServiceAccount \u4ee4\u724c\u5e76\u4e14\u6ca1\u6709\u4efb\u4f55\u663e\u5f0f\u7684\u6743\u9650\u5206\u914d\u3002"),(0,i.kt)("p",null,"\u5bf9\u4e8e\u6807\u51c6 RKE \u4e2d\u7684\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\uff08\u5305\u62ec ",(0,i.kt)("strong",{parentName:"p"},"default")," \u548c ",(0,i.kt)("strong",{parentName:"p"},"kube-system"),"\uff09\uff0c",(0,i.kt)("strong",{parentName:"p"},"default")," ServiceAccount \u5fc5\u987b\u5305\u542b\u4ee5\u4e0b\u503c\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"automountServiceAccountToken: false\n")),(0,i.kt)("p",null,"\u5c06\u4ee5\u4e0b\u914d\u7f6e\u4fdd\u5b58\u5230\u540d\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"account_update.yaml")," \u7684\u6587\u4ef6\u4e2d:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: default\nautomountServiceAccountToken: false\n")),(0,i.kt)("p",null,"\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"account_update.sh")," \u7684 bash \u811a\u672c\u6587\u4ef6\u3002\u786e\u4fdd\u4e3a\u811a\u672c\u8bbe\u7f6e\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"chmod +x account_update.sh"),"\uff0c\u4f7f\u811a\u672c\u5177\u6709\u6267\u884c\u6743\u9650\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/bash -e\n\nfor namespace in $(kubectl get namespaces -A -o=jsonpath="{.items[*][\'metadata.name\']}"); do\n  kubectl patch serviceaccount default -n ${namespace} -p "$(cat account_update.yaml)"\ndone\n')),(0,i.kt)("h3",{id:"\u914d\u7f6e\u7f51\u7edc\u7b56\u7565"},"\u914d\u7f6e\u7f51\u7edc\u7b56\u7565"),(0,i.kt)("h4",{id:"\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565"},"\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565"),(0,i.kt)("p",null,"\u5982\u679c\u4f60\u5728\u540c\u4e00\u4e2a Kubernetes \u96c6\u7fa4\u4e0a\u8fd0\u884c\u4e0d\u540c\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u88ab\u611f\u67d3\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u653b\u51fb\u76f8\u90bb\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u8981\u786e\u4fdd\u5bb9\u5668\u53ea\u8fdb\u884c\u6240\u9700\u7684\u901a\u4fe1\uff0c\u7f51\u7edc\u5206\u6bb5\u975e\u5e38\u91cd\u8981\u3002\u7f51\u7edc\u7b56\u7565\u6307\u7684\u662f\u5982\u4f55\u5141\u8bb8 Pod \u4e0e\u5176\u4ed6 Pod \u4ee5\u53ca\u4e0e\u5176\u4ed6\u7f51\u7edc\u7aef\u70b9\u8fdb\u884c\u901a\u4fe1\u3002"),(0,i.kt)("p",null,"\u7f51\u7edc\u7b56\u7565\u662f\u547d\u540d\u7a7a\u95f4\u8303\u56f4\u7684\u3002\u4e3a\u67d0\u4e2a\u547d\u540d\u7a7a\u95f4\u914d\u7f6e\u7f51\u7edc\u7b56\u7565\u540e\uff0c\u8be5\u7b56\u7565\u4e0d\u5141\u8bb8\u7684\u6240\u6709\u5176\u4ed6\u6d41\u91cf\u90fd\u4f1a\u88ab\u62d2\u7edd\u3002\u4f46\u662f\uff0c\u5982\u679c\u547d\u540d\u7a7a\u95f4\u6ca1\u6709\u914d\u7f6e\u7f51\u7edc\u7b56\u7565\uff0c\u5219\u6240\u6709\u6d41\u91cf\u90fd\u4f1a\u5141\u8bb8\u8fdb\u51fa\u8be5\u547d\u540d\u7a7a\u95f4\u4e2d\u7684 Pod\u3002\u8981\u6267\u884c\u7f51\u7edc\u7b56\u7565\uff0c\u4f60\u5fc5\u987b\u542f\u7528 CNI\uff08\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\uff09\u63d2\u4ef6\u3002\u672c\u6307\u5357\u4f7f\u7528 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/projectcalico/canal"},"Canal")," \u6765\u6267\u884c\u7b56\u7565\u3002\u6709\u5173 CNI \u7f51\u7edc\u63d2\u4ef6\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605",(0,i.kt)("a",{parentName:"p",href:"https://www.suse.com/c/rancher_blog/comparing-kubernetes-cni-providers-flannel-calico-canal-and-weave/"},"\u8fd9\u91cc"),"\u3002"),(0,i.kt)("p",null,"\u5728\u96c6\u7fa4\u4e0a\u542f\u7528\u4e86 CNI \u7f51\u7edc\u63d2\u4ef6\u540e\uff0c\u4f60\u5c31\u53ef\u4ee5\u5e94\u7528\u9ed8\u8ba4\u7f51\u7edc\u7b56\u7565\u4e86\u3002\u4ee5\u4e0b\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4f9b\u53c2\u8003\u7684 ",(0,i.kt)("strong",{parentName:"p"},"permissive")," \u793a\u4f8b\u3002\u5982\u679c\u8981\u5141\u8bb8\u6240\u6709\u6d41\u91cf\u53d1\u9001\u5230\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6240\u6709 pod\uff08\u5373\u4f7f\u6dfb\u52a0\u4e86\u5bfc\u81f4\u67d0\u4e9b pod \u88ab\u201c\u9694\u79bb\u201d\u7684\u7b56\u7565\uff09\uff0c\u4f60\u53ef\u4ee5\u663e\u5f0f\u521b\u5efa\u4e00\u4e2a\u7b56\u7565\u6765\u5141\u8bb8\u8be5\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6240\u6709\u6d41\u91cf\u3002\u5c06\u4ee5\u4e0b\u914d\u7f6e\u4fdd\u5b58\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"default-allow-all.yaml"),"\u3002\u5982\u9700\u67e5\u770b\u7f51\u7edc\u7b56\u7565\u76f8\u5173\u7684\u5176\u4ed6",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/services-networking/network-policies/"},"\u6587\u6863"),"\uff0c\u8bf7\u524d\u5f80 Kubernetes \u7f51\u7ad9\u3002"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"\u6b64 ",(0,i.kt)("inlineCode",{parentName:"p"},"NetworkPolicy")," \u53ea\u662f\u4e00\u4e2a\u793a\u4f8b\uff0c\u4e0d\u5efa\u8bae\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u3002"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"---\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-allow-all\nspec:\n  podSelector: {}\n  ingress:\n  - {}\n  egress:\n  - {}\n  policyTypes:\n  - Ingress\n  - Egress\n")),(0,i.kt)("p",null,"\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"apply_networkPolicy_to_all_ns.sh")," \u7684 bash \u811a\u672c\u6587\u4ef6\u3002\u786e\u4fdd\u4e3a\u811a\u672c\u8bbe\u7f6e\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"chmod +x apply_networkPolicy_to_all_ns.sh"),"\uff0c\u4f7f\u811a\u672c\u5177\u6709\u6267\u884c\u6743\u9650\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash -e\n\nfor namespace in $(kubectl get namespaces -A -o=jsonpath=\"{.items[*]['metadata.name']}\"); do\n  kubectl apply -f default-allow-all.yaml -n ${namespace}\ndone\n")),(0,i.kt)("p",null,"\u6267\u884c\u6b64\u811a\u672c\u80fd\u5c06\u5177\u6709 ",(0,i.kt)("strong",{parentName:"p"},"permissive")," ",(0,i.kt)("inlineCode",{parentName:"p"},"NetworkPolicy")," \u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"default-allow-all.yaml")," \u914d\u7f6e\u5e94\u7528\u4e8e\u6240\u6709\u547d\u540d\u7a7a\u95f4\u3002"),(0,i.kt)("h3",{id:"\u5f3a\u5316-rke-clusteryml-\u914d\u7f6e\u53c2\u8003"},"\u5f3a\u5316 RKE ",(0,i.kt)("inlineCode",{parentName:"h3"},"cluster.yml")," \u914d\u7f6e\u53c2\u8003"),(0,i.kt)("p",null,"RKE CLI \u80fd\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"cluster.yml")," \u914d\u7f6e\u53c2\u8003\uff0c\u8be5\u6587\u4ef6\u63d0\u4f9b\u4e86\u5b9e\u73b0 Rancher Kubernetes Engine (RKE) \u7684\u5f3a\u5316\u5b89\u88c5\u6240\u9700\u7684\u914d\u7f6e\u3002RKE \u7684",(0,i.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rke/latest/en/installation/"},"\u5b89\u88c5\u6587\u6863"),"\u4ecb\u7ecd\u4e86\u6709\u5173\u914d\u7f6e\u9879\u7684\u5176\u4ed6\u8be6\u7ec6\u4fe1\u606f\u3002\u6b64 ",(0,i.kt)("inlineCode",{parentName:"p"},"cluster.yml")," \u53c2\u8003\u4e0d\u5305\u62ec\u6240\u9700\u7684 ",(0,i.kt)("strong",{parentName:"p"},"nodes")," \u53c2\u6570\uff0c\u8be5\u53c2\u6570\u4f1a\u56e0\u4f60\u7684\u73af\u5883\u800c\u5f02\u3002\u5982\u9700\u67e5\u770b RKE \u4e2d\u8282\u70b9\u914d\u7f6e\u7684\u6587\u6863\uff0c\u8bf7\u53c2\u9605",(0,i.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rke/latest/en/config-options/nodes/"},"\u6b64\u5904"),"\u3002"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"\u91cd\u8981\u63d0\u793a\uff1a")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"\u5bf9\u4e8e Kubernetes 1.18 \u96c6\u7fa4\uff0c\u8bf7\u4ece ",(0,i.kt)("inlineCode",{parentName:"p"},"PodSecurityPolicy")," \u4e2d\u5220\u9664 ",(0,i.kt)("inlineCode",{parentName:"p"},"spec.volumes: 'ephemeral'")," \u914d\u7f6e\uff0c\u56e0\u4e3a\u6b64 Kubernetes \u7248\u672c\u4e0d\u652f\u6301\u5b83\u3002"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'# \u5982\u679c\u4f60\u6253\u7b97\u5728\u79bb\u7ebf\u73af\u5883\u4e2d\u90e8\u7f72 Kubernetes\uff0c\n# \u8bf7\u67e5\u9605\u914d\u7f6e\u81ea\u5b9a\u4e49 RKE \u955c\u50cf\u7684\u6587\u6863\u3002\n# https://rancher.com/docs/rke/latest/en/installation/\n\n# nodes \u53c2\u6570\u662f\u5fc5\u9700\u7684\uff0c\u5e76\u4e14\u4f1a\u6839\u636e\u4f60\u7684\u73af\u5883\u800c\u6709\u6240\u4e0d\u540c\u3002\n# \u8282\u70b9\u914d\u7f6e\u7684\u6587\u6863\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\uff1a\n# https://rancher.com/docs/rke/latest/en/config-options/nodes/\nnodes: []\nservices:\n  etcd:\n    image: ""\n    extra_args: {}\n    extra_binds: []\n    extra_env: []\n    win_extra_args: {}\n    win_extra_binds: []\n    win_extra_env: []\n    external_urls: []\n    ca_cert: ""\n    cert: ""\n    key: ""\n    path: ""\n    uid: 52034\n    gid: 52034\n    snapshot: false\n    retention: ""\n    creation: ""\n    backup_config: null\n  kube-api:\n    image: ""\n    extra_args: {}\n    extra_binds: []\n    extra_env: []\n    win_extra_args: {}\n    win_extra_binds: []\n    win_extra_env: []\n    service_cluster_ip_range: ""\n    service_node_port_range: ""\n    pod_security_policy: true\n    always_pull_images: false\n    secrets_encryption_config:\n      enabled: true\n      custom_config: null\n    audit_log:\n      enabled: true\n      configuration: null\n    admission_configuration: null\n    event_rate_limit:\n      enabled: true\n      configuration: null\n  kube-controller:\n    image: ""\n    extra_args:\n      feature-gates: RotateKubeletServerCertificate=true\n      tls-cipher-suites: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n      bind-address: 127.0.0.1\n    extra_binds: []\n    extra_env: []\n    win_extra_args: {}\n    win_extra_binds: []\n    win_extra_env: []\n    cluster_cidr: ""\n    service_cluster_ip_range: ""\n  scheduler:\n    image: ""\n    extra_args:\n      tls-cipher-suites: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n      bind-address: 127.0.0.1\n    extra_binds: []\n    extra_env: []\n    win_extra_args: {}\n    win_extra_binds: []\n    win_extra_env: []\n  kubelet:\n    image: ""\n    extra_args:\n      feature-gates: RotateKubeletServerCertificate=true\n      protect-kernel-defaults: true\n      tls-cipher-suites: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n    extra_binds: []\n    extra_env: []\n    win_extra_args: {}\n    win_extra_binds: []\n    win_extra_env: []\n    cluster_domain: cluster.local\n    infra_container_image: ""\n    cluster_dns_server: ""\n    fail_swap_on: false\n    generate_serving_certificate: true\n  kubeproxy:\n    image: ""\n    extra_args: {}\n    extra_binds: []\n    extra_env: []\n    win_extra_args: {}\n    win_extra_binds: []\n    win_extra_env: []\nnetwork:\n  plugin: ""\n  options: {}\n  mtu: 0\n  node_selector: {}\n  update_strategy: null\nauthentication:\n  strategy: ""\n  sans: []\n  webhook: null\naddons: |\n  # Upstream Kubernetes restricted PSP policy\n  # https://github.com/kubernetes/website/blob/564baf15c102412522e9c8fc6ef2b5ff5b6e766c/content/en/examples/policy/restricted-psp.yaml\n  apiVersion: policy/v1beta1\n  kind: PodSecurityPolicy\n  metadata:\n    name: restricted-noroot\n  spec:\n    privileged: false\n    # Required to prevent escalations to root.\n    allowPrivilegeEscalation: false\n    requiredDropCapabilities:\n      - ALL\n    # Allow core volume types.\n    volumes:\n      - \'configMap\'\n      - \'emptyDir\'\n      - \'projected\'\n      - \'secret\'\n      - \'downwardAPI\'\n      # Assume that ephemeral CSI drivers & persistentVolumes set up by the cluster admin are safe to use.\n      - \'csi\'\n      - \'persistentVolumeClaim\'\n      - \'ephemeral\'\n    hostNetwork: false\n    hostIPC: false\n    hostPID: false\n    runAsUser:\n      # Require the container to run without root privileges.\n      rule: \'MustRunAsNonRoot\'\n    seLinux:\n      # This policy assumes the nodes are using AppArmor rather than SELinux.\n      rule: \'RunAsAny\'\n    supplementalGroups:\n      rule: \'MustRunAs\'\n      ranges:\n        # Forbid adding the root group.\n        - min: 1\n          max: 65535\n    fsGroup:\n      rule: \'MustRunAs\'\n      ranges:\n        # Forbid adding the root group.\n        - min: 1\n          max: 65535\n    readOnlyRootFilesystem: false\n  ---\n  apiVersion: rbac.authorization.k8s.io/v1\n  kind: ClusterRole\n  metadata:\n    name: psp:restricted-noroot\n  rules:\n  - apiGroups:\n    - extensions\n    resourceNames:\n    - restricted-noroot\n    resources:\n    - podsecuritypolicies\n    verbs:\n    - use\n  ---\n  apiVersion: rbac.authorization.k8s.io/v1\n  kind: ClusterRoleBinding\n  metadata:\n    name: psp:restricted-noroot\n  roleRef:\n    apiGroup: rbac.authorization.k8s.io\n    kind: ClusterRole\n    name: psp:restricted-noroot\n  subjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: Group\n    name: system:serviceaccounts\n  - apiGroup: rbac.authorization.k8s.io\n    kind: Group\n    name: system:authenticated\n  ---\n  apiVersion: networking.k8s.io/v1\n  kind: NetworkPolicy\n  metadata:\n    name: default-allow-all\n  spec:\n    podSelector: {}\n    ingress:\n    - {}\n    egress:\n    - {}\n    policyTypes:\n    - Ingress\n    - Egress\n  ---\n  apiVersion: v1\n  kind: ServiceAccount\n  metadata:\n    name: default\n  automountServiceAccountToken: false\naddons_include: []\nsystem_images:\n  etcd: ""\n  alpine: ""\n  nginx_proxy: ""\n  cert_downloader: ""\n  kubernetes_services_sidecar: ""\n  kubedns: ""\n  dnsmasq: ""\n  kubedns_sidecar: ""\n  kubedns_autoscaler: ""\n  coredns: ""\n  coredns_autoscaler: ""\n  nodelocal: ""\n  kubernetes: ""\n  flannel: ""\n  flannel_cni: ""\n  calico_node: ""\n  calico_cni: ""\n  calico_controllers: ""\n  calico_ctl: ""\n  calico_flexvol: ""\n  canal_node: ""\n  canal_cni: ""\n  canal_controllers: ""\n  canal_flannel: ""\n  canal_flexvol: ""\n  weave_node: ""\n  weave_cni: ""\n  pod_infra_container: ""\n  ingress: ""\n  ingress_backend: ""\n  metrics_server: ""\n  windows_pod_infra_container: ""\nssh_key_path: ""\nssh_cert_path: ""\nssh_agent_auth: false\nauthorization:\n  mode: ""\n  options: {}\nignore_docker_version: false\nkubernetes_version: ""\nprivate_registries: []\ningress:\n  provider: ""\n  options: {}\n  node_selector: {}\n  extra_args: {}\n  dns_policy: ""\n  extra_envs: []\n  extra_volumes: []\n  extra_volume_mounts: []\n  update_strategy: null\n  http_port: 0\n  https_port: 0\n  network_mode: ""\ncluster_name:\ncloud_provider:\n  name: ""\nprefix_path: ""\nwin_prefix_path: ""\naddon_job_timeout: 0\nbastion_host:\n  address: ""\n  port: ""\n  user: ""\n  ssh_key: ""\n  ssh_key_path: ""\n  ssh_cert: ""\n  ssh_cert_path: ""\nmonitoring:\n  provider: ""\n  options: {}\n  node_selector: {}\n  update_strategy: null\n  replicas: null\nrestore:\n  restore: false\n  snapshot_name: ""\ndns: null\nupgrade_strategy:\n  max_unavailable_worker: ""\n  max_unavailable_controlplane: ""\n  drain: null\n  node_drain_input: null\n')),(0,i.kt)("h3",{id:"\u5f3a\u5316-rke-\u6a21\u677f\u914d\u7f6e\u53c2\u8003"},"\u5f3a\u5316 RKE \u6a21\u677f\u914d\u7f6e\u53c2\u8003"),(0,i.kt)("p",null,"RKE \u6a21\u677f\u53c2\u8003\u63d0\u4f9b\u4e86\u5b9e\u73b0 Kubernetes \u5f3a\u5316\u5b89\u88c5\u6240\u9700\u7684\u914d\u7f6e\u3002RKE \u6a21\u677f\u7528\u4e8e\u914d\u7f6e Kubernetes \u548c\u5b9a\u4e49 Rancher \u8bbe\u7f6e\u3002\u5982\u9700\u4e86\u89e3\u5b89\u88c5\u4ee5\u53ca RKE \u6a21\u677f\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Rancher ",(0,i.kt)("a",{parentName:"p",href:"/zh/pages-for-subheaders/installation-and-upgrade"},"\u6587\u6863"),"\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"#\n# Cluster Config\n#\ndefault_pod_security_policy_template_id: restricted-noroot\ndocker_root_dir: /var/lib/docker\nenable_cluster_alerting: false\nenable_cluster_monitoring: false\nenable_network_policy: true\nlocal_cluster_auth_endpoint:\n  enabled: true\nname: ''\n#\n# Rancher Config\n#\nrancher_kubernetes_engine_config:\n  addon_job_timeout: 45\n  authentication:\n    strategy: x509\n  dns:\n    nodelocal:\n      ip_address: ''\n      node_selector: null\n      update_strategy: {}\n  enable_cri_dockerd: false\n  ignore_docker_version: true\n#\n# # \u76ee\u524d\u4ec5\u652f\u6301 Nginx ingress provider\n# # \u8981\u7981\u7528 Ingress controller\uff0c\u8bbe\u7f6e `provider: none`\n# # \u8981\u5728\u6307\u5b9a\u8282\u70b9\u4e0a\u7981\u7528 Ingress\uff0c\u4f7f\u7528 node_selector\uff0c\u4f8b\u5982\uff1a\n#    provider: nginx\n#    node_selector:\n#      app: ingress\n#\n  ingress:\n    default_backend: false\n    default_ingress_class: true\n    http_port: 0\n    https_port: 0\n    provider: nginx\n  kubernetes_version: v1.21.8-rancher1-1\n  monitoring:\n    provider: metrics-server\n    replicas: 1\n#\n#   \u5982\u679c\u4f60\u5728 AWS \u4f7f\u7528 Calico\n#\n#    network:\n#      plugin: calico\n#      calico_network_provider:\n#        cloud_provider: aws\n#\n# # \u8981\u6307\u5b9a Flannel \u63a5\u53e3\n#\n#    network:\n#      plugin: flannel\n#      flannel_network_provider:\n#      iface: eth1\n#\n# # \u8981\u4e3a Canal \u63d2\u4ef6\u6307\u5b9a Flannel \u63a5\u53e3\n#\n#    network:\n#      plugin: canal\n#      canal_network_provider:\n#        iface: eth1\n#\n  network:\n    mtu: 0\n    options:\n      flannel_backend_type: vxlan\n    plugin: canal\n  rotate_encryption_key: false\n#\n#    services:\n#      kube-api:\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kube-controller:\n#        cluster_cidr: 10.42.0.0/16\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kubelet:\n#        cluster_domain: cluster.local\n#        cluster_dns_server: 10.43.0.10\n#\n  services:\n    scheduler:\n      extra_args:\n        tls-cipher-suites: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n      bind-address: 127.0.0.1\n    etcd:\n      backup_config:\n        enabled: true\n        interval_hours: 12\n        retention: 6\n        safe_timestamp: false\n        timeout: 300\n      creation: 12h\n      extra_args:\n        election-timeout: 5000\n        heartbeat-interval: 500\n      retention: 72h\n      snapshot: false\n      uid: 52034\n      gid: 52034\n    kube_api:\n      always_pull_images: false\n      audit_log:\n        enabled: true\n      event_rate_limit:\n        enabled: true\n      pod_security_policy: true\n      secrets_encryption_config:\n        enabled: true\n      service_node_port_range: 30000-32767\n    kube-controller:\n      extra_args:\n        feature-gates: RotateKubeletServerCertificate=true\n        tls-cipher-suites: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n      bind-address: 127.0.0.1\n    kubelet:\n      extra_args:\n        feature-gates: RotateKubeletServerCertificate=true\n        protect-kernel-defaults: true\n        tls-cipher-suites: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n      fail_swap_on: false\n      generate_serving_certificate: true\n  ssh_agent_auth: false\n  upgrade_strategy:\n    max_unavailable_controlplane: '1'\n    max_unavailable_worker: 10%\nwindows_prefered_cluster: false\n")),(0,i.kt)("h3",{id:"\u5f3a\u5316-cloud-config-\u914d\u7f6e\u53c2\u8003"},"\u5f3a\u5316 ",(0,i.kt)("inlineCode",{parentName:"h3"},"cloud-config")," \u914d\u7f6e\u53c2\u8003"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"cloud-config")," \u914d\u7f6e\u6587\u4ef6\u901a\u5e38\u7528\u4e8e\u4e91\u57fa\u7840\u8bbe\u65bd\u73af\u5883\u4e2d\uff0c\u80fd\u8ba9\u4f60\u7ba1\u7406\u8ba1\u7b97\u5b9e\u4f8b\u7684\u914d\u7f6e\u3002\u6b64\u53c2\u8003 config \u914d\u7f6e\u4e86\u5b89\u88c5 Kubernetes \u4e4b\u524d\u6240\u9700\u7684 SUSE Linux Enterprise Server (SLES)\u3001openSUSE Leap\u3001Red Hat Enterprise Linux (RHEL) \u548c Ubuntu \u64cd\u4f5c\u7cfb\u7edf\u7ea7\u522b\u7684\u8bbe\u7f6e\u3002"),(0,i.kt)("h4",{id:"\u9488\u5bf9-suse-linux-enterprise-server-15-sles-15-\u548c-opensuse-leap-15-\u7684\u5f3a\u5316-cloud-config-\u53c2\u8003"},"\u9488\u5bf9 SUSE Linux Enterprise Server 15 (SLES 15) \u548c openSUSE Leap 15 \u7684\u5f3a\u5316 ",(0,i.kt)("strong",{parentName:"h4"},"cloud-config")," \u53c2\u8003"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'#cloud-config\nsystem_info:\n  default_user:\n    groups:\n    - docker\nwrite_files:\n- path: "/etc/sysctl.d/90-kubelet.conf"\n  owner: root:root\n  permissions: \'0644\'\n  content: |\n    vm.overcommit_memory=1\n    vm.panic_on_oom=0\n    kernel.panic=10\n    kernel.panic_on_oops=1\n    kernel.keys.root_maxbytes=25000000\npackage_update: true\nssh_pwauth: false\nruncmd:\n# Docker \u5e94\u8be5\u5df2\u5728 SLES 15 SP3 \u4e2d\u5b89\u88c5\n- zypper install docker containerd\n- systemctl daemon-reload\n- systemctl enable docker.service\n- systemctl start --no-block docker.service\n- sysctl -p /etc/sysctl.d/90-kubelet.conf\n- groupadd --gid 52034 etcd\n- useradd --comment "etcd service account" --uid 52034 --gid 52034 etcd --shell /usr/sbin/nologin\n')),(0,i.kt)("h4",{id:"\u9488\u5bf9-red-hat-enterprise-linux-8-rhel-8-\u548c-ubuntu-2004-lts-\u7684\u5f3a\u5316-cloud-config-\u53c2\u8003"},"\u9488\u5bf9 Red Hat Enterprise Linux 8 (RHEL 8) \u548c Ubuntu 20.04 LTS \u7684\u5f3a\u5316 ",(0,i.kt)("strong",{parentName:"h4"},"cloud-config")," \u53c2\u8003"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'#cloud-config\nsystem_info:\n  default_user:\n    groups:\n    - docker\nwrite_files:\n- path: "/etc/sysctl.d/90-kubelet.conf"\n  owner: root:root\n  permissions: \'0644\'\n  content: |\n    vm.overcommit_memory=1\n    vm.panic_on_oom=0\n    kernel.panic=10\n    kernel.panic_on_oops=1\n    kernel.keys.root_maxbytes=25000000\npackage_update: true\nssh_pwauth: false\nruncmd:\n# \u4f7f\u7528 Rancher \u7684 Docker \u5b89\u88c5\u811a\u672c\u6765\u5b89\u88c5 Docker - github.com/rancher/install-docker\n- curl https://releases.rancher.com/install-docker/20.10.sh | sh\n- sysctl -p /etc/sysctl.d/90-kubelet.conf\n- groupadd --gid 52034 etcd\n- useradd --comment "etcd service account" --uid 52034 --gid 52034 etcd --shell /usr/sbin/nologin\n')))}p.isMDXComponent=!0}}]);