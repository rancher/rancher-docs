<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-2.6 plugin-docs plugin-id-default docs-doc-id-reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Tuning and Best Practices for Rancher at Scale | Rancher</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ranchermanager.docs.rancher.com/zh/v2.6/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="2.6"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.6"><meta data-rh="true" name="docsearch:version" content="2.6"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.6"><meta data-rh="true" property="og:title" content="Tuning and Best Practices for Rancher at Scale | Rancher"><meta data-rh="true" name="description" content="This guide describes the best practices and tuning approaches to scale Rancher setups and the associated challenges with doing so. As systems grow, performance will naturally reduce, but there are steps that can minimize the load put on Rancher and optimize Rancher&#x27;s ability to manage larger infrastructures."><meta data-rh="true" property="og:description" content="This guide describes the best practices and tuning approaches to scale Rancher setups and the associated challenges with doing so. As systems grow, performance will naturally reduce, but there are steps that can minimize the load put on Rancher and optimize Rancher&#x27;s ability to manage larger infrastructures."><link data-rh="true" rel="icon" href="/zh/img/favicon.png"><link data-rh="true" rel="alternate" href="https://ranchermanager.docs.rancher.com/v2.6/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale" hreflang="en"><link data-rh="true" rel="alternate" href="https://ranchermanager.docs.rancher.com/zh/v2.6/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale" hreflang="zh"><link data-rh="true" rel="alternate" href="https://ranchermanager.docs.rancher.com/v2.6/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://30NEY6C9UY-dsn.algolia.net" crossorigin="anonymous"><link data-rh="true" rel="canonical" href="https://ranchermanager.docs.rancher.com/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>



<link rel="search" type="application/opensearchdescription+xml" title="Rancher" href="/zh/opensearch.xml">



<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="0f98beb0-fc4c-417d-a42e-564e2cae42d2" async></script>
<script src="/scripts/optanonwrapper.js" async></script><link rel="stylesheet" href="/zh/assets/css/styles.539b57ae.css">
<link rel="preload" href="/zh/assets/js/runtime~main.4432415f.js" as="script">
<link rel="preload" href="/zh/assets/js/main.d74255db.js" as="script">
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/v2.6">v2.6</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale">Latest</a></li><li><a class="dropdown__link" href="/zh/v2.8/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale">v2.8</a></li><li><a class="dropdown__link" href="/zh/v2.7/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale">v2.7</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/v2.6/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale">v2.6</a></li><li><a class="dropdown__link" href="/zh/v2.5">v2.5</a></li><li><a class="dropdown__link" href="/zh/v2.0-v2.4">v2.0-v2.4</a></li><li><a class="dropdown__link" href="/zh/versions">All versions</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/v2.6/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/v2.6/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Quick Links</a><ul class="dropdown__menu"><li><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/rancher/rancher-docs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Docs GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More from SUSE</a><ul class="dropdown__menu"><li><a href="https://www.rancher.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher">Rancher<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://elemental.docs.rancher.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__elemental">Elemental<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://fleet.rancher.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__fleet">Fleet<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://harvesterhci.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__harvester">Harvester<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://rancherdesktop.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher__desktop">Rancher Desktop<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://opensource.suse.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__suse">More Projects...<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v2.6">什么是 Rancher？</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.6/getting-started/overview">开始使用</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.6/how-to-guides/new-user-guides">操作指南</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/v2.6/reference-guides/best-practices">参考指南</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/zh/v2.6/reference-guides/best-practices">最佳实践</a><button aria-label="打开/收起侧边栏菜单「最佳实践」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/zh/v2.6/reference-guides/best-practices/rancher-server">Rancher Server</a><button aria-label="打开/收起侧边栏菜单「Rancher Server」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.6/reference-guides/best-practices/rancher-server/on-premises-rancher-in-vsphere">在 vSphere 环境中安装 Rancher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.6/reference-guides/best-practices/rancher-server/rancher-deployment-strategy">Rancher 部署策略</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.6/reference-guides/best-practices/rancher-server/tips-for-running-rancher">Rancher 运行技巧</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/v2.6/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale">Tuning and Best Practices for Rancher at Scale</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/best-practices/rancher-managed-clusters">Rancher 管理的集群</a><button aria-label="打开/收起侧边栏菜单「Rancher 管理的集群」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/rancher-manager-architecture">Rancher 架构</a><button aria-label="打开/收起侧边栏菜单「Rancher 架构」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/cluster-configuration">集群配置</a><button aria-label="打开/收起侧边栏菜单「集群配置」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/single-node-rancher-in-docker">Docker 中的单节点 Rancher</a><button aria-label="打开/收起侧边栏菜单「Docker 中的单节点 Rancher」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/backup-restore-configuration">备份和恢复配置</a><button aria-label="打开/收起侧边栏菜单「备份和恢复配置」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.6/reference-guides/kubernetes-concepts">Kubernetes 概念</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/monitoring-v2-configuration">Monitoring 配置</a><button aria-label="打开/收起侧边栏菜单「Monitoring 配置」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/prometheus-federator">Prometheus Federator</a><button aria-label="打开/收起侧边栏菜单「Prometheus Federator」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/user-settings">用户设置</a><button aria-label="打开/收起侧边栏菜单「用户设置」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/cli-with-rancher">Rancher CLI</a><button aria-label="打开/收起侧边栏菜单「Rancher CLI」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/about-the-api">关于 API</a><button aria-label="打开/收起侧边栏菜单「关于 API」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.6/reference-guides/rancher-cluster-tools">集群工具：Logging，Monitoring 和可视化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.6/reference-guides/rancher-project-tools">项目工具：Logging，Monitoring 和可视化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.6/reference-guides/system-tools">系统工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v2.6/reference-guides/rke1-template-example-yaml">RKE1 示例 YAML</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/pipelines">流水线</a><button aria-label="打开/收起侧边栏菜单「流水线」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/v2.6/reference-guides/rancher-security">Rancher 安全指南</a><button aria-label="打开/收起侧边栏菜单「Rancher 安全指南」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.6/integrations-in-rancher/cloud-marketplace">Rancher 中的集成</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.6/faq/general-faq">常见问题</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v2.6/troubleshooting/general-troubleshooting">故障排除</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v2.6/contribute-to-rancher">参与 Rancher 社区贡献</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">参考指南</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/v2.6/reference-guides/best-practices"><span itemprop="name">最佳实践</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/v2.6/reference-guides/best-practices/rancher-server"><span itemprop="name">Rancher Server</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Tuning and Best Practices for Rancher at Scale</span><meta itemprop="position" content="4"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：v2.6</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Tuning and Best Practices for Rancher at Scale</h1></header><p>This guide describes the best practices and tuning approaches to scale Rancher setups and the associated challenges with doing so. As systems grow, performance will naturally reduce, but there are steps that can minimize the load put on Rancher and optimize Rancher&#x27;s ability to manage larger infrastructures.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimizing-rancher-performance">Optimizing Rancher Performance<a href="#optimizing-rancher-performance" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><ul><li><p>Keep Rancher up to date with patch releases. We are continuously improving Rancher with performance enhancements and bug fixes. The latest Rancher release contains all accumulated improvements to performance and stability, plus updates based on developer experience and user feedback.</p></li><li><p>Always scale up gradually, and monitor and observe any changes in behavior while doing do. It is usually easier to resolve performance problems as soon as they surface, before other problems obscure the root cause.</p></li><li><p>Reduce network latency between the upstream Rancher cluster and downstream clusters to the extent possible. Note that latency is, among other factors, a function of geographic distance - if you require clusters or nodes spread across the world, consider multiple Rancher installations.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="minimizing-load-on-the-upstream-cluster">Minimizing Load on the Upstream Cluster<a href="#minimizing-load-on-the-upstream-cluster" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>When scaling up Rancher, one typical bottleneck is resource growth in the upstream (local) Kubernetes cluster. The upstream cluster contains information for all downstream clusters. Many operations that apply to downstream clusters create new objects in the upstream cluster and require computation from handlers running in the upstream cluster.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="minimizing-third-party-software-on-the-upstream-cluster">Minimizing Third-Party Software on the Upstream Cluster<a href="#minimizing-third-party-software-on-the-upstream-cluster" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Running Rancher at scale can put significant load on internal Kubernetes components, such as <code>etcd</code> or <code>kubeapiserver</code>. Issues may arise if third-party software interferes with the performance of those components or with Rancher.</p><p>Every third-party piece of software carries a risk of interference. To prevent performance issues on the upstream cluster, you should avoid running any other apps or components, beyond Kubernetes system components and Rancher itself.</p><p>Software in the following categories generally won&#x27;t interfere with Rancher or Kubernetes system performance:</p><ul><li>Rancher internal components, such as Fleet</li><li>Rancher extensions</li><li>Cluster API components</li><li>CNIs</li><li>Cloud controller managers</li><li>Observability and monitoring tools (with the exception of prometheus-rancher-exporter)</li></ul><p>On the other hand, the following software are found to interfere with Rancher performance at scale:</p><ul><li><a href="https://www.crossplane.io/" target="_blank" rel="noopener noreferrer">CrossPlane</a></li><li><a href="https://argoproj.github.io/cd/" target="_blank" rel="noopener noreferrer">Argo CD</a></li><li><a href="https://fluxcd.io/" target="_blank" rel="noopener noreferrer">Flux</a></li><li><a href="https://github.com/David-VTUK/prometheus-rancher-exporter" target="_blank" rel="noopener noreferrer">prometheus-rancher-exporter</a> (see <a href="https://github.com/David-VTUK/prometheus-rancher-exporter/issues/33" target="_blank" rel="noopener noreferrer">issue 33</a>)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="managing-your-object-counts">Managing Your Object Counts<a href="#managing-your-object-counts" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Etcd is the backing database for Kubernetes and for Rancher. The database may eventually encounter limitations to the number of a single Kubernetes resource type it can store. Exact limits vary and depend on a number of factors. However, experience indicates that performance issues frequently arise once a single resource type&#x27;s object count exceeds 60,000. Often that type is <code>RoleBinding</code>.</p><p>This is typical in Rancher, as many operations create new <code>RoleBinding</code> objects in the upstream cluster as a side effect.</p><p>You can reduce the number of <code>RoleBindings</code> in the upstream cluster in the following ways:</p><ul><li>Limit the use of the <a href="/zh/v2.6/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/manage-role-based-access-control-rbac/global-permissions.md#restricted-admin">Restricted Admin</a> role. Apply other roles wherever possible.</li><li>If you use <a href="/zh/v2.6/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/authentication-config/authentication-config.md">external authentication</a>, use groups to assign roles.</li><li>Only add users to clusters and projects when necessary.</li><li>Remove clusters and projects when they are no longer needed.</li><li>Only use custom roles if necessary.</li><li>Use as few rules as possible in custom roles.</li><li>Consider whether adding a role to a user is redundant.</li><li>Consider using less, but more powerful, clusters.</li><li>Kubernetes permissions are always &quot;additive&quot; (allow-list) rather than &quot;subtractive&quot; (deny-list). Try to minimize configurations that gives access to all but one aspect of a cluster, project, or namespace, as that will result in the creation of a high number of <code>RoleBinding</code> objects.</li><li>Experiment to see if creating new projects or clusters manifests in fewer <code>RoleBindings</code> for your specific use case.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rolebinding-count-estimation">RoleBinding Count Estimation<a href="#rolebinding-count-estimation" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Predicting how many <code>RoleBinding</code> objects a given configuration will create is complicated. However, the following considerations can offer a rough estimate:</p><ul><li>For a minimum estimate, use the formula <code>32C + U + 2UaC + 8P + 5Pa</code>. <ul><li><code>C</code> is the total number of clusters.</li><li><code>U</code> is the total number of users.</li><li><code>Ua</code> is the average number of users with a membership on a cluster.</li><li><code>P</code> is the total number of projects.</li><li><code>Pa</code> is the average number of users with a membership on a project.</li></ul></li><li>The Restricted Admin role follows a different formula, as every user with this role results in at least <code>7C + 2P + 2</code> additional <code>RoleBinding</code> objects.</li><li>The number of <code>RoleBindings</code> increases linearly with the number of clusters, projects, and users.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-new-apps-over-legacy-apps">Using New Apps Over Legacy Apps<a href="#using-new-apps-over-legacy-apps" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Rancher uses two Kubernetes app resources: <code>apps.projects.cattle.io</code> and <code>apps.cattle.cattle.io</code>. Legacy apps, represented by <code>apps.projects.cattle.io</code>, were introduced with the former Cluster Manager UI and are now outdated. Current apps, represented by <code>apps.catalog.cattle.io</code>, are found in the Cluster Explorer UI for their respective cluster. <code>Apps.cattle.cattle.io</code> apps are preferable because their data resides in downstream clusters, which frees up resources in the upstream cluster.</p><p>You should remove any remaining legacy apps that appear in the Cluster Manager UI, and replace them with apps in the Cluster Explorer UI. Create any new apps only in the Cluster Explorer UI.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-authorized-cluster-endpoint-ace">Using the Authorized Cluster Endpoint (ACE)<a href="#using-the-authorized-cluster-endpoint-ace" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>An <a href="/zh/v2.6/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters.md#4-authorized-cluster-endpoint">Authorized Cluster Endpoint</a> (ACE) provides access to the Kubernetes API of Rancher-provisioned RKE, RKE2, and K3s clusters. When enabled, the ACE adds a context to kubeconfig files generated for the cluster. The context uses a direct endpoint to the cluster, thereby bypassing Rancher. This reduces load on Rancher for cases where unmediated API access is acceptable or preferable. See <a href="/zh/v2.6/reference-guides/rancher-manager-architecture/communicating-with-downstream-user-clusters.md#4-authorized-cluster-endpoint">Authorized Cluster Endpoint</a> for more information and configuration instructions.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reducing-event-handler-executions">Reducing Event Handler Executions<a href="#reducing-event-handler-executions" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>The bulk of Rancher&#x27;s logic occurs on event handlers. These event handlers run on an object whenever the object is updated, and when Rancher is started. Additionally, they run every 15 hours when Rancher syncs caches. In scaled setups these scheduled runs come with huge performance costs because every handler is being run on every applicable object. However, the scheduled handler execution can be disabled with the <code>CATTLE_SYNC_ONLY_CHANGED_OBJECTS</code> environment variable. If resource allocation spikes are seen every 15 hours, this setting can help.</p><p>The value for <code>CATTLE_SYNC_ONLY_CHANGED_OBJECTS</code> can be a comma separated list of the following options. The values refer to types of handlers and controllers (the structures that contain and run handlers). Adding the controller types to the variable disables that set of controllers from running their handlers as part of cache resyncing.</p><ul><li><code>mgmt</code> refers to management controllers which only run on one Rancher node.</li><li><code>user</code> refers to user controllers which run for every cluster. Some of these run on the same node as management controllers, while others run in the downstream cluster. This option targets the former.</li><li><code>scaled</code> refers to scaled controllers which run on every Rancher node. You should avoid setting this value, as the scaled handlers are responsible for critical functions and changes may disrupt cluster stability.</li></ul><p>In short, if you notice CPU usage peaks every 15 hours, add the <code>CATTLE_SYNC_ONLY_CHANGED_OBJECTS</code> environment variable to your Rancher deployment (in the <code>spec.containers.env</code> list) with the value <code>mgmt,user</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimizations-outside-of-rancher">Optimizations Outside of Rancher<a href="#optimizations-outside-of-rancher" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>Important influencing factors are the underlying cluster&#x27;s own performance and configuration. The upstream cluster, if misconfigured, can introduce a bottleneck Rancher software has no chance to resolve.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="manage-upstream-cluster-nodes-directly-with-rke2">Manage Upstream Cluster Nodes Directly with RKE2<a href="#manage-upstream-cluster-nodes-directly-with-rke2" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>As Rancher can be very demanding on the upstream cluster, especially at scale, you should have full administrative control of the cluster&#x27;s configuration and nodes. To identify the root cause of excess resource consumption, use standard Linux troubleshooting techniques and tools. This can aid in distinguishing between whether Rancher, Kubernetes, or operating system components are causing issues. </p><p>Although managed Kubernetes services make it easier to deploy and run Kubernetes clusters, they are discouraged for the upstream cluster in high scale scenarios. Managed Kubernetes services typically limit access to configuration and insights on individual nodes and services.</p><p>Use RKE2 for large scale use cases.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="keeping-kubernetes-versions-up-to-date">Keeping Kubernetes Versions Up to Date<a href="#keeping-kubernetes-versions-up-to-date" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>You should keep the local Kubernetes cluster up to date. This will ensure that your cluster has all available performance enhancements and bug fixes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optimizing-etcd">Optimizing etcd<a href="#optimizing-etcd" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Etcd is the backend database for Kubernetes and for Rancher. It plays a very important role in Rancher performance.</p><p>The two main bottlenecks to <a href="https://etcd.io/docs/v3.4/op-guide/performance/" target="_blank" rel="noopener noreferrer">etcd performance</a> are disk and network speed. Etcd should run on dedicated nodes with a fast network setup and with SSDs that have high input/output operations per second (IOPS). For more information regarding etcd performance, see <a href="https://www.suse.com/support/kb/doc/?id=000020100" target="_blank" rel="noopener noreferrer">Slow etcd performance (performance testing and optimization)</a> and <a href="/zh/v2.6/how-to-guides/advanced-user-guides/tune-etcd-for-large-installs.md">Tuning etcd for Large Installations</a>. Information on disks can also be found in the <a href="/zh/v2.6/getting-started/installation-and-upgrade/installation-requirements/installation-requirements.md#disks">Installation Requirements</a>.</p><p>It&#x27;s best to run etcd on exactly three nodes, as adding more nodes will reduce operation speed. This may be counter-intuitive to common scaling approaches, but it&#x27;s due to etcd&#x27;s <a href="https://etcd.io/docs/v3.5/faq/#what-is-maximum-cluster-size" target="_blank" rel="noopener noreferrer">replication mechanisms</a>.</p><p>Etcd performance will also be negatively affected by network latency between nodes as that will slow down network communication. Etcd nodes should be located together with Rancher nodes.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.6/reference-guides/best-practices/rancher-server/tuning-and-best-practices-for-rancher-at-scale.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2024-02-06T16:22:32.000Z">2024年2月6日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/v2.6/reference-guides/best-practices/rancher-server/tips-for-running-rancher"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Rancher 运行技巧</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/v2.6/reference-guides/best-practices/rancher-managed-clusters"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Best Practices for Rancher Managed Clusters</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#optimizing-rancher-performance" class="table-of-contents__link toc-highlight">Optimizing Rancher Performance</a></li><li><a href="#minimizing-load-on-the-upstream-cluster" class="table-of-contents__link toc-highlight">Minimizing Load on the Upstream Cluster</a><ul><li><a href="#minimizing-third-party-software-on-the-upstream-cluster" class="table-of-contents__link toc-highlight">Minimizing Third-Party Software on the Upstream Cluster</a></li><li><a href="#managing-your-object-counts" class="table-of-contents__link toc-highlight">Managing Your Object Counts</a></li><li><a href="#rolebinding-count-estimation" class="table-of-contents__link toc-highlight">RoleBinding Count Estimation</a></li><li><a href="#using-new-apps-over-legacy-apps" class="table-of-contents__link toc-highlight">Using New Apps Over Legacy Apps</a></li><li><a href="#using-the-authorized-cluster-endpoint-ace" class="table-of-contents__link toc-highlight">Using the Authorized Cluster Endpoint (ACE)</a></li><li><a href="#reducing-event-handler-executions" class="table-of-contents__link toc-highlight">Reducing Event Handler Executions</a></li></ul></li><li><a href="#optimizations-outside-of-rancher" class="table-of-contents__link toc-highlight">Optimizations Outside of Rancher</a><ul><li><a href="#manage-upstream-cluster-nodes-directly-with-rke2" class="table-of-contents__link toc-highlight">Manage Upstream Cluster Nodes Directly with RKE2</a></li><li><a href="#keeping-kubernetes-versions-up-to-date" class="table-of-contents__link toc-highlight">Keeping Kubernetes Versions Up to Date</a></li><li><a href="#optimizing-etcd" class="table-of-contents__link toc-highlight">Optimizing etcd</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.4432415f.js"></script>
<script src="/zh/assets/js/main.d74255db.js"></script>
</body>
</html>