---
title: 配置全局默认私有镜像仓库
---

:::note
本页介绍了安装 Rancher 后如何从 Rancher UI 配置全局默认私有镜像仓库。

有关如何在 Rancher 安装期间设置私有镜像仓库的说明，请参阅[离线安装指南](../../../pages-for-subheaders/air-gapped-helm-cli-install.md)。

:::

私有镜像仓库是集群中私有、一致且集中的容器镜像源。你可以使用私有容器镜像仓库，在组织内共享自定义基础镜像。

在 Rancher 中设置私有镜像仓库主要有两种方式：

* 通过全局视图中的 **Settings** 选项卡设置全局默认镜像仓库。
* 在集群级别设置下的高级选项中设置私有镜像仓库。

全局默认镜像仓库适用于离线环境，可用于不需要凭证的镜像仓库。而集群级私有镜像仓库用于需要凭证的私有镜像仓库。

## 将不需要凭证的私有镜像仓库设置为默认镜像仓库

1. 登录 Rancher 并配置默认管理员密码。
1. 选择 **☰ > 全局设置**。
1. 转到 `system-default-registry` 并选择 **⋮ > 编辑设置**。
1. 输入你镜像仓库的主机名和端口（例如 `registry.yourdomain.com:port`）。不要在文本前加上 `http://` 或 `https://`。

**结果**：Rancher 会从你的私有镜像仓库中拉取系统镜像。

### 带 RKE2 下游集群的命名空间私有镜像仓库

默认情况下，大多数私有镜像仓库应该能与 RKE2 下游集群一起工作。

但是，如果你尝试设置 URL 格式为 `website/subdomain:portnumber` 的命名空间私有镜像仓库，则需要执行额外的步骤：

1. 选择 **☰ > 集群管理**。
1. 在列表中找到 RKE2 集群，然后点击 **⋮ > 编辑配置**。
1. 从**集群配置**菜单中，选择**镜像仓库**。
1. 在**镜像仓库**中，选择**配置高级 Containerd Mirror 和仓库认证选项**选项。
1. 在 **Mirrors** 下的文本字段中，输入**镜像仓库主机名**和 **Mirror 端点**。
1. 单击**保存**。
1. 根据需要对每个下游 RKE2 集群重复操作。

## 创建集群时配置使用凭证的私有镜像仓库

无法为每个 Rancher 配置的集群全局设置具有授权认证的私有镜像仓库。因此，如果你希望 Rancher 配置的集群从使用凭证的私有镜像仓库中拉取镜像，则每次创建新集群时都必须通过高级集群选项传递镜像仓库凭证。

由于创建集群后无法配置私有镜像仓库，因此你需要在初始集群设置期间执行这些步骤。

1. 选择 **☰ > 集群管理**。
1. 在**集群**页面上，单击**创建**。
1. 选择集群类型。
1. 在**集群配置**中，转到**镜像仓库**选项卡，然后选择**为 Rancher 从私有镜像仓库中拉取镜像**。
1. 输入镜像仓库主机名和凭证。
1. 单击**创建**。

**结果**：新集群将从私有镜像仓库中拉取镜像。
