"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[15872],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(a),h=r,m=d["".concat(s,".").concat(h)]||d[h]||u[h]||l;return a?n.createElement(m,o(o({ref:t},p),{},{components:a})):n.createElement(m,o({ref:t},p))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,o=new Array(l);o[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var c=2;c<l;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},85162:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(86010);const l="tabItem_Ymn6";function o(e){let{children:t,hidden:a,className:o}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(l,o),hidden:a},t)}},65488:(e,t,a)=>{a.d(t,{Z:()=>h});var n=a(87462),r=a(67294),l=a(86010),o=a(72389),i=a(67392),s=a(7094),c=a(12466);const p="tabList__CuJ",u="tabItem_LNqP";function d(e){const{lazy:t,block:a,defaultValue:o,values:d,groupId:h,className:m}=e,g=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),k=d??g.map((e=>{let{props:{value:t,label:a,attributes:n}}=e;return{value:t,label:a,attributes:n}})),f=(0,i.l)(k,((e,t)=>e.value===t.value));if(f.length>0)throw new Error(`Docusaurus error: Duplicate values "${f.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const N=null===o?o:o??g.find((e=>e.props.default))?.props.value??g[0].props.value;if(null!==N&&!k.some((e=>e.value===N)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${N}" but none of its children has the corresponding value. Available values are: ${k.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:b}=(0,s.U)(),[R,v]=(0,r.useState)(N),C=[],{blockElementScrollPositionUntilNextRender:T}=(0,c.o5)();if(null!=h){const e=y[h];null!=e&&e!==R&&k.some((t=>t.value===e))&&v(e)}const O=e=>{const t=e.currentTarget,a=C.indexOf(t),n=k[a].value;n!==R&&(T(t),v(n),null!=h&&b(h,String(n)))},I=e=>{let t=null;switch(e.key){case"Enter":O(e);break;case"ArrowRight":{const a=C.indexOf(e.currentTarget)+1;t=C[a]??C[0];break}case"ArrowLeft":{const a=C.indexOf(e.currentTarget)-1;t=C[a]??C[C.length-1];break}}t?.focus()};return r.createElement("div",{className:(0,l.Z)("tabs-container",p)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":a},m)},k.map((e=>{let{value:t,label:a,attributes:o}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:R===t?0:-1,"aria-selected":R===t,key:t,ref:e=>C.push(e),onKeyDown:I,onClick:O},o,{className:(0,l.Z)("tabs__item",u,o?.className,{"tabs__item--active":R===t})}),a??t)}))),t?(0,r.cloneElement)(g.filter((e=>e.props.value===R))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},g.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==R})))))}function h(e){const t=(0,o.Z)();return r.createElement(d,(0,n.Z)({key:String(t)},e))}},8931:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>u});var n=a(87462),r=(a(67294),a(3905)),l=a(65488),o=a(85162);const i={title:"4. Install Rancher"},s=void 0,c={unversionedId:"getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/air-gap-helm2/install-rancher",id:"version-2.0-2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/air-gap-helm2/install-rancher",title:"4. Install Rancher",description:"This section is about how to deploy Rancher for your air gapped environment. An air gapped environment could be where Rancher server will be installed offline, behind a firewall, or behind a proxy. There are tabs for either a high availability (recommended) or a Docker installation.",source:"@site/versioned_docs/version-2.0-2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/air-gap-helm2/install-rancher.md",sourceDirName:"getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/air-gap-helm2",slug:"/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/air-gap-helm2/install-rancher",permalink:"/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/air-gap-helm2/install-rancher",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.0-2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/air-gap-helm2/install-rancher.md",tags:[],version:"2.0-2.4",lastUpdatedAt:1663953084,formattedLastUpdatedAt:"Sep 23, 2022",frontMatter:{title:"4. Install Rancher"},sidebar:"tutorialSidebar",previous:{title:"3. Install Kubernetes with RKE (Kubernetes Installs Only)",permalink:"/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/air-gap-helm2/launch-kubernetes"},next:{title:"Opening Ports with firewalld",permalink:"/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/open-ports-with-firewalld"}},p={},u=[{value:"A. Add the Helm Chart Repository",id:"a-add-the-helm-chart-repository",level:3},{value:"B. Choose your SSL Configuration",id:"b-choose-your-ssl-configuration",level:3},{value:"C. Render the Rancher Helm Template",id:"c-render-the-rancher-helm-template",level:3},{value:"D. Install Rancher",id:"d-install-rancher",level:3},{value:"E. For Rancher versions before v2.3.0, Configure System Charts",id:"e-for-rancher-versions-before-v230-configure-system-charts",level:3},{value:"Additional Resources",id:"additional-resources",level:3}],d={toc:u};function h(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This section is about how to deploy Rancher for your air gapped environment. An air gapped environment could be where Rancher server will be installed offline, behind a firewall, or behind a proxy. There are ",(0,r.kt)("em",{parentName:"p"},"tabs")," for either a high availability (recommended) or a Docker installation."),(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Kubernetes Install (Recommended)",mdxType:"TabItem"},(0,r.kt)("p",null,"Rancher recommends installing Rancher on a Kubernetes cluster. A highly available Kubernetes Installation is comprised of three nodes running the Rancher server components on a Kubernetes cluster. The persistence layer (etcd) is also replicated on these three nodes, providing redundancy and data duplication in case one of the nodes fails."),(0,r.kt)("p",null,"This section describes installing Rancher in five parts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#a-add-the-helm-chart-repository"},"A. Add the Helm Chart Repository")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#b-choose-your-ssl-configuration"},"B. Choose your SSL Configuration")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#c-render-the-rancher-helm-template"},"C. Render the Rancher Helm Template")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#d-install-rancher"},"D. Install Rancher")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#e-for-rancher-versions-before-v2-3-0-configure-system-charts"},"E. For Rancher versions before v2.3.0, Configure System Charts"))),(0,r.kt)("h3",{id:"a-add-the-helm-chart-repository"},"A. Add the Helm Chart Repository"),(0,r.kt)("p",null,"From a system that has access to the internet, fetch the latest Helm chart and copy the resulting manifests to a system that has access to the Rancher server cluster."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If you haven't already, initialize ",(0,r.kt)("inlineCode",{parentName:"p"},"helm")," locally on a workstation that has internet access. Note: Refer to the ",(0,r.kt)("a",{parentName:"p",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/choose-a-rancher-version"},"Helm version requirements")," to choose a version of Helm to install Rancher."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"helm init -c\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"helm repo add")," command to add the Helm chart repository that contains charts to install Rancher. For more information about the repository choices and which is best for your use case, see ",(0,r.kt)("a",{parentName:"p",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/choose-a-rancher-version"},"Choosing a Version of Rancher"),"."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Latest: Recommended for trying out the newest features",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"helm repo add rancher-latest https://releases.rancher.com/server-charts/latest\n"))),(0,r.kt)("li",{parentName:"ul"},"Stable: Recommended for production environments",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"helm repo add rancher-stable https://releases.rancher.com/server-charts/stable\n"))),(0,r.kt)("li",{parentName:"ul"},"Alpha: Experimental preview of upcoming releases.",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"helm repo add rancher-stable https://releases.rancher.com/server-charts/stable\n")),"  Note: Upgrades are not supported to, from, or between Alphas."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Fetch the latest Rancher chart. This will pull down the chart and save it in the current directory as a ",(0,r.kt)("inlineCode",{parentName:"p"},".tgz")," file."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"helm fetch rancher-<CHART_REPO>/rancher\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Want additional options? See the Rancher ",(0,r.kt)("a",{parentName:"p",href:"/v2.0-v2.4/reference-guides/installation-references/helm-chart-options"},"Helm chart options"),".")),(0,r.kt)("h3",{id:"b-choose-your-ssl-configuration"},"B. Choose your SSL Configuration"),(0,r.kt)("p",null,"Rancher Server is designed to be secure by default and requires SSL/TLS configuration."),(0,r.kt)("p",null,"When Rancher is installed on an air gapped Kubernetes cluster, there are two recommended options for the source of the certificate."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note:")," If you want terminate SSL/TLS externally, see ",(0,r.kt)("a",{parentName:"p",href:"../../../../../reference-guides/installation-references/helm-chart-options#external-tls-termination"},"TLS termination on an External Load Balancer"),".")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Configuration"),(0,r.kt)("th",{parentName:"tr",align:null},"Chart option"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Requires cert-manager"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Rancher Generated Self-Signed Certificates"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ingress.tls.source=rancher")),(0,r.kt)("td",{parentName:"tr",align:null},"Use certificates issued by Rancher's generated CA (self signed)",(0,r.kt)("br",null)," This is the ",(0,r.kt)("strong",{parentName:"td"},"default")," and does not need to be added when rendering the Helm template."),(0,r.kt)("td",{parentName:"tr",align:null},"yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Certificates from Files"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ingress.tls.source=secret")),(0,r.kt)("td",{parentName:"tr",align:null},"Use your own certificate files by creating Kubernetes Secret(s). ",(0,r.kt)("br",null)," This option must be passed when rendering the Rancher Helm template."),(0,r.kt)("td",{parentName:"tr",align:null},"no")))),(0,r.kt)("h3",{id:"c-render-the-rancher-helm-template"},"C. Render the Rancher Helm Template"),(0,r.kt)("p",null,"When setting up the Rancher Helm template, there are several options in the Helm chart that are designed specifically for air gap installations."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Chart Option"),(0,r.kt)("th",{parentName:"tr",align:null},"Chart Value"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"certmanager.version")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<version>")),(0,r.kt)("td",{parentName:"tr",align:null},"Configure proper Rancher TLS issuer depending of running cert-manager version.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"systemDefaultRegistry")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<REGISTRY.YOURDOMAIN.COM:PORT>")),(0,r.kt)("td",{parentName:"tr",align:null},"Configure Rancher server to always pull from your private registry when provisioning clusters.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"useBundledSystemChart")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"true")),(0,r.kt)("td",{parentName:"tr",align:null},"Configure Rancher server to use the packaged copy of Helm system charts. The ",(0,r.kt)("a",{parentName:"td",href:"https://github.com/rancher/system-charts"},"system charts")," repository contains all the catalog items required for features such as monitoring, logging, alerting and global DNS. These ",(0,r.kt)("a",{parentName:"td",href:"https://github.com/rancher/system-charts"},"Helm charts")," are located in GitHub, but since you are in an air gapped environment, using the charts that are bundled within Rancher is much easier than setting up a Git mirror. ",(0,r.kt)("em",{parentName:"td"},"Available as of v2.3.0"))))),(0,r.kt)("p",null,"Based on the choice your made in ",(0,r.kt)("a",{parentName:"p",href:"#b-choose-your-ssl-configuration"},"B. Choose your SSL Configuration"),", complete one of the procedures below."),(0,r.kt)("details",{id:"self-signed"},(0,r.kt)("summary",null,"Option A-Default Self-Signed Certificate"),(0,r.kt)("p",null,"By default, Rancher generates a CA and uses cert-manager to issue the certificate for access to the Rancher server interface."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note:"),"\nRecent changes to cert-manager require an upgrade. If you are upgrading Rancher and using a version of cert-manager older than v0.11.0, please see our ",(0,r.kt)("a",{parentName:"p",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/upgrade-cert-manager"},"upgrade cert-manager documentation"),".")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"From a system connected to the internet, add the cert-manager repo to Helm."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"helm repo add jetstack https://charts.jetstack.io\nhelm repo update\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Fetch the latest cert-manager chart available from the ",(0,r.kt)("a",{parentName:"p",href:"https://hub.helm.sh/charts/jetstack/cert-manager"},"Helm chart repository"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"helm fetch jetstack/cert-manager --version v0.14.2\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Render the cert manager template with the options you would like to use to install the chart. Remember to set the ",(0,r.kt)("inlineCode",{parentName:"p"},"image.repository")," option to pull the image from your private registry. This will create a ",(0,r.kt)("inlineCode",{parentName:"p"},"cert-manager")," directory with the Kubernetes manifest files."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"helm template ./cert-manager-v0.14.2.tgz --output-dir . \\\n    --name cert-manager --namespace cert-manager \\\n    --set image.repository=<REGISTRY.YOURDOMAIN.COM:PORT>/quay.io/jetstack/cert-manager-controller\n    --set webhook.image.repository=<REGISTRY.YOURDOMAIN.COM:PORT>/quay.io/jetstack/cert-manager-webhook\n    --set cainjector.image.repository=<REGISTRY.YOURDOMAIN.COM:PORT>/quay.io/jetstack/cert-manager-cainjector\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Download the required CRD file for cert-manager"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"curl -L -o cert-manager/cert-manager-crd.yaml https://raw.githubusercontent.com/jetstack/cert-manager/release-0.14/deploy/manifests/00-crds.yaml\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Render the Rancher template, declaring your chosen options. Use the reference table below to replace each placeholder. Rancher needs to be configured to use the private registry in order to provision any Rancher launched Kubernetes clusters or Rancher tools."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Placeholder | Description\n------------|-------------\n`<VERSION>` | The version number of the output tarball.\n`<RANCHER.YOURDOMAIN.COM>` | The DNS name you pointed at your load balancer.\n`<REGISTRY.YOURDOMAIN.COM:PORT>` | The DNS name for your private registry.\n`<CERTMANAGER_VERSION>` | Cert-manager version running on k8s cluster.\n\n ```plain\nhelm template ./rancher-<VERSION>.tgz --output-dir . \\\n --name rancher \\\n --namespace cattle-system \\\n --set hostname=<RANCHER.YOURDOMAIN.COM> \\\n --set certmanager.version=<CERTMANAGER_VERSION> \\\n --set rancherImage=<REGISTRY.YOURDOMAIN.COM:PORT>/rancher/rancher \\\n --set systemDefaultRegistry=<REGISTRY.YOURDOMAIN.COM:PORT> \\ # Available as of v2.2.0, set a default private registry to be used in Rancher\n --set useBundledSystemChart=true # Available as of v2.3.0, use the packaged Rancher system charts\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'\n</details>\n\n<details id="secret">\n  <summary>Option B: Certificates From Files using Kubernetes Secrets</summary>\n\nCreate Kubernetes secrets from your own certificates for Rancher to use. The common name for the cert will need to match the `hostname` option in the command below, or the ingress controller will fail to provision the site for Rancher.\n\nRender the Rancher template, declaring your chosen options. Use the reference table below to replace each placeholder. Rancher needs to be configured to use the private registry in order to provision any Rancher launched Kubernetes clusters or Rancher tools.\n\n| Placeholder                      | Description                                     |\n| -------------------------------- | ----------------------------------------------- |\n| `<VERSION>`                      | The version number of the output tarball.       |\n| `<RANCHER.YOURDOMAIN.COM>`       | The DNS name you pointed at your load balancer. |\n| `<REGISTRY.YOURDOMAIN.COM:PORT>` | The DNS name for your private registry.         |\n\n```plain\n   helm template ./rancher-<VERSION>.tgz --output-dir . \\\n    --name rancher \\\n    --namespace cattle-system \\\n    --set hostname=<RANCHER.YOURDOMAIN.COM> \\\n    --set rancherImage=<REGISTRY.YOURDOMAIN.COM:PORT>/rancher/rancher \\\n    --set ingress.tls.source=secret \\\n    --set systemDefaultRegistry=<REGISTRY.YOURDOMAIN.COM:PORT> \\ # Available as of v2.2.0, set a default private registry to be used in Rancher\n    --set useBundledSystemChart=true # Available as of v2.3.0, use the packaged Rancher system charts\n')),(0,r.kt)("p",null,"If you are using a Private CA signed cert, add ",(0,r.kt)("inlineCode",{parentName:"p"},"--set privateCA=true")," following ",(0,r.kt)("inlineCode",{parentName:"p"},"--set ingress.tls.source=secret"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"   helm template ./rancher-<VERSION>.tgz --output-dir . \\\n    --name rancher \\\n    --namespace cattle-system \\\n    --set hostname=<RANCHER.YOURDOMAIN.COM> \\\n    --set rancherImage=<REGISTRY.YOURDOMAIN.COM:PORT>/rancher/rancher \\\n    --set ingress.tls.source=secret \\\n    --set privateCA=true \\\n    --set systemDefaultRegistry=<REGISTRY.YOURDOMAIN.COM:PORT> \\ # Available as of v2.2.0, set a default private registry to be used in Rancher\n    --set useBundledSystemChart=true # Available as of v2.3.0, use the packaged Rancher system charts\n")),(0,r.kt)("p",null,"Then refer to ",(0,r.kt)("a",{parentName:"p",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/add-tls-secrets"},"Adding TLS Secrets")," to publish the certificate files so Rancher and the ingress controller can use them.")),(0,r.kt)("h3",{id:"d-install-rancher"},"D. Install Rancher"),(0,r.kt)("p",null,"Copy the rendered manifest directories to a system that has access to the Rancher server cluster to complete installation."),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl")," to create namespaces and apply the rendered manifests."),(0,r.kt)("p",null,"If you choose to use self-signed certificates in ",(0,r.kt)("a",{parentName:"p",href:"#b-choose-your-ssl-configuration"},"B. Choose your SSL Configuration"),", install cert-manager."),(0,r.kt)("details",{id:"install-cert-manager"},(0,r.kt)("summary",null,"Self-Signed Certificate Installs - Install Cert-manager"),(0,r.kt)("p",null,"If you are using self-signed certificates, install cert-manager:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create the namespace for cert-manager.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"kubectl create namespace cert-manager\n")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create the cert-manager CustomResourceDefinitions (CRDs).")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"kubectl apply -f cert-manager/cert-manager-crd.yaml\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Important:"),"\nIf you are running Kubernetes v1.15 or below, you will need to add the `--validate=false flag to your kubectl apply command above else you will receive a validation error relating to the x-kubernetes-preserve-unknown-fields field in cert-manager\u2019s CustomResourceDefinition resources. This is a benign error and occurs due to the way kubectl performs resource validation.")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Launch cert-manager.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"kubectl apply -R -f ./cert-manager\n"))),(0,r.kt)("p",null,"Install Rancher:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"kubectl create namespace cattle-system\nkubectl -n cattle-system apply -R -f ./rancher\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step Result:")," If you are installing Rancher v2.3.0+, the installation is complete."),(0,r.kt)("h3",{id:"e-for-rancher-versions-before-v230-configure-system-charts"},"E. For Rancher versions before v2.3.0, Configure System Charts"),(0,r.kt)("p",null,"If you are installing Rancher versions before v2.3.0, you will not be able to use the packaged system charts. Since the Rancher system charts are hosted in Github, an air gapped installation will not be able to access these charts. Therefore, you must ",(0,r.kt)("a",{parentName:"p",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/local-system-charts"},"configure the Rancher system charts"),"."),(0,r.kt)("h3",{id:"additional-resources"},"Additional Resources"),(0,r.kt)("p",null,"These resources could be helpful when installing Rancher:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/v2.0-v2.4/reference-guides/installation-references/helm-chart-options"},"Rancher Helm chart options")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/add-tls-secrets"},"Adding TLS secrets")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/troubleshooting"},"Troubleshooting Rancher Kubernetes Installations")))),(0,r.kt)(o.Z,{value:"Docker Install",mdxType:"TabItem"},(0,r.kt)("p",null,"The Docker installation is for Rancher users that are wanting to ",(0,r.kt)("strong",{parentName:"p"},"test")," out Rancher. Instead of running on a Kubernetes cluster, you install the Rancher server component on a single node using a ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run")," command. Since there is only one node and a single Docker container, if the node goes down, there is no copy of the etcd data available on other nodes and you will lose all the data of your Rancher server. ",(0,r.kt)("strong",{parentName:"p"},"Important: If you install Rancher following the Docker installation guide, there is no upgrade path to transition your Docker installation to a Kubernetes Installation.")," Instead of running the single node installation, you have the option to follow the Kubernetes Install guide, but only use one node to install Rancher. Afterwards, you can scale up the etcd nodes in your Kubernetes cluster to make it a Kubernetes Installation."),(0,r.kt)("p",null,"For security purposes, SSL (Secure Sockets Layer) is required when using Rancher. SSL secures all Rancher network communication, like when you login or interact with a cluster."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Environment Variable Key"),(0,r.kt)("th",{parentName:"tr",align:null},"Environment Variable Value"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CATTLE_SYSTEM_DEFAULT_REGISTRY")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<REGISTRY.YOURDOMAIN.COM:PORT>")),(0,r.kt)("td",{parentName:"tr",align:null},"Configure Rancher server to always pull from your private registry when provisioning clusters.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CATTLE_SYSTEM_CATALOG")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"bundled")),(0,r.kt)("td",{parentName:"tr",align:null},"Configure Rancher server to use the packaged copy of Helm system charts. The ",(0,r.kt)("a",{parentName:"td",href:"https://github.com/rancher/system-charts"},"system charts")," repository contains all the catalog items required for features such as monitoring, logging, alerting and global DNS. These ",(0,r.kt)("a",{parentName:"td",href:"https://github.com/rancher/system-charts"},"Helm charts")," are located in GitHub, but since you are in an air gapped environment, using the charts that are bundled within Rancher is much easier than setting up a Git mirror. ",(0,r.kt)("em",{parentName:"td"},"Available as of v2.3.0"))))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Do you want to...")),(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},"Configure custom CA root certificate to access your services? See ",(0,r.kt)("a",{parentName:"li",href:"../../../../../reference-guides/installation-references/helm-chart-options#additional-trusted-cas"},"Custom CA root certificate"),"."),(0,r.kt)("li",{parentName:"ul"},"Record all transactions with the Rancher API? See ",(0,r.kt)("a",{parentName:"li",href:"/v2.0-v2.4/reference-guides/single-node-rancher-in-docker/advanced-options#api-audit-log"},"API Auditing"),"."))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For Rancher before v2.3.0, you will need to mirror the ",(0,r.kt)("inlineCode",{parentName:"li"},"system-charts")," repository to a location in your network that Rancher can reach. Then, after Rancher is installed, you will need to configure Rancher to use that repository. For details, refer to the documentation on ",(0,r.kt)("a",{parentName:"li",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/local-system-charts"},"setting up the system charts for Rancher before v2.3.0."))),(0,r.kt)("p",null,"Choose from the following options:"),(0,r.kt)("details",{id:"option-a"},(0,r.kt)("summary",null,"Option A-Default Self-Signed Certificate"),(0,r.kt)("p",null,"If you are installing Rancher in a development or testing environment where identity verification isn't a concern, install Rancher using the self-signed certificate that it generates. This installation option omits the hassle of generating a certificate yourself."),(0,r.kt)("p",null,"Log into your Linux host, and then run the installation command below. When entering the command, use the table below to replace each placeholder."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<REGISTRY.YOURDOMAIN.COM:PORT>")),(0,r.kt)("td",{parentName:"tr",align:null},"Your private registry URL and port.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,r.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,r.kt)("a",{parentName:"td",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/choose-a-rancher-version"},"Rancher version")," that you want to install.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"docker run -d --restart=unless-stopped \\\n    -p 80:80 -p 443:443 \\\n    -e CATTLE_SYSTEM_DEFAULT_REGISTRY=<REGISTRY.YOURDOMAIN.COM:PORT> \\ # Set a default private registry to be used in Rancher\n    -e CATTLE_SYSTEM_CATALOG=bundled \\ #Available as of v2.3.0, use the packaged Rancher system charts\n    <REGISTRY.YOURDOMAIN.COM:PORT>/rancher/rancher:<RANCHER_VERSION_TAG>\n"))),(0,r.kt)("details",{id:"option-b"},(0,r.kt)("summary",null,"Option B-Bring Your Own Certificate: Self-Signed"),(0,r.kt)("p",null,"In development or testing environments where your team will access your Rancher server, create a self-signed certificate for use with your install so that your team can verify they're connecting to your instance of Rancher."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Prerequisites:"),"\nFrom a computer with an internet connection, create a self-signed certificate using ",(0,r.kt)("a",{parentName:"p",href:"https://www.openssl.org/"},"OpenSSL")," or another method of your choice."),(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},"The certificate files must be in PEM format."),(0,r.kt)("li",{parentName:"ul"},"In your certificate file, include all intermediate certificates in the chain. Order your certificates with your certificate first, followed by the intermediates. For an example, see ",(0,r.kt)("a",{parentName:"li",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/certificate-troubleshooting"},"Certificate Troubleshooting.")))),(0,r.kt)("p",null,"After creating your certificate, log into your Linux host, and then run the installation command below. When entering the command, use the table below to replace each placeholder. Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"-v")," flag and provide the path to your certificates to mount them in your container."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<CERT_DIRECTORY>")),(0,r.kt)("td",{parentName:"tr",align:null},"The path to the directory containing your certificate files.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<FULL_CHAIN.pem>")),(0,r.kt)("td",{parentName:"tr",align:null},"The path to your full certificate chain.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<PRIVATE_KEY.pem>")),(0,r.kt)("td",{parentName:"tr",align:null},"The path to the private key for your certificate.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<CA_CERTS>")),(0,r.kt)("td",{parentName:"tr",align:null},"The path to the certificate authority's certificate.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<REGISTRY.YOURDOMAIN.COM:PORT>")),(0,r.kt)("td",{parentName:"tr",align:null},"Your private registry URL and port.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,r.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,r.kt)("a",{parentName:"td",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/choose-a-rancher-version"},"Rancher version")," that you want to install.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"docker run -d --restart=unless-stopped \\\n    -p 80:80 -p 443:443 \\\n    -v /<CERT_DIRECTORY>/<FULL_CHAIN.pem>:/etc/rancher/ssl/cert.pem \\\n    -v /<CERT_DIRECTORY>/<PRIVATE_KEY.pem>:/etc/rancher/ssl/key.pem \\\n    -v /<CERT_DIRECTORY>/<CA_CERTS.pem>:/etc/rancher/ssl/cacerts.pem \\\n    -e CATTLE_SYSTEM_DEFAULT_REGISTRY=<REGISTRY.YOURDOMAIN.COM:PORT> \\ # Set a default private registry to be used in Rancher\n    -e CATTLE_SYSTEM_CATALOG=bundled \\ #Available as of v2.3.0, use the packaged Rancher system charts\n    <REGISTRY.YOURDOMAIN.COM:PORT>/rancher/rancher:<RANCHER_VERSION_TAG>\n"))),(0,r.kt)("details",{id:"option-c"},(0,r.kt)("summary",null,"Option C-Bring Your Own Certificate: Signed by Recognized CA"),(0,r.kt)("p",null,"In development or testing environments where you're exposing an app publicly, use a certificate signed by a recognized CA so that your user base doesn't encounter security warnings."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Prerequisite:")," The certificate files must be in PEM format.")),(0,r.kt)("p",null,"After obtaining your certificate, log into your Linux host, and then run the installation command below. When entering the command, use the table below to replace each placeholder. Because your certificate is signed by a recognized CA, mounting an additional CA certificate file is unnecessary."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<CERT_DIRECTORY>")),(0,r.kt)("td",{parentName:"tr",align:null},"The path to the directory containing your certificate files.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<FULL_CHAIN.pem>")),(0,r.kt)("td",{parentName:"tr",align:null},"The path to your full certificate chain.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<PRIVATE_KEY.pem>")),(0,r.kt)("td",{parentName:"tr",align:null},"The path to the private key for your certificate.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<REGISTRY.YOURDOMAIN.COM:PORT>")),(0,r.kt)("td",{parentName:"tr",align:null},"Your private registry URL and port.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,r.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,r.kt)("a",{parentName:"td",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/choose-a-rancher-version"},"Rancher version")," that you want to install.")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note:")," Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"--no-cacerts")," as argument to the container to disable the default CA certificate generated by Rancher.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"docker run -d --restart=unless-stopped \\\n    -p 80:80 -p 443:443 \\\n    --no-cacerts \\\n    -v /<CERT_DIRECTORY>/<FULL_CHAIN.pem>:/etc/rancher/ssl/cert.pem \\\n    -v /<CERT_DIRECTORY>/<PRIVATE_KEY.pem>:/etc/rancher/ssl/key.pem \\\n    -e CATTLE_SYSTEM_DEFAULT_REGISTRY=<REGISTRY.YOURDOMAIN.COM:PORT> \\ # Set a default private registry to be used in Rancher\n    -e CATTLE_SYSTEM_CATALOG=bundled \\ #Available as of v2.3.0, use the packaged Rancher system charts\n    <REGISTRY.YOURDOMAIN.COM:PORT>/rancher/rancher:<RANCHER_VERSION_TAG>\n"))),(0,r.kt)("p",null,"If you are installing Rancher v2.3.0+, the installation is complete."),(0,r.kt)("p",null,"If you are installing Rancher versions before v2.3.0, you will not be able to use the packaged system charts. Since the Rancher system charts are hosted in Github, an air gapped installation will not be able to access these charts. Therefore, you must ",(0,r.kt)("a",{parentName:"p",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/resources/local-system-charts"},"configure the Rancher system charts"),"."))))}h.isMDXComponent=!0}}]);