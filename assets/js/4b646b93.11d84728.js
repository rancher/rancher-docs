"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[5008],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),h=c(a),d=r,m=h["".concat(s,".").concat(d)]||h[d]||p[d]||l;return a?n.createElement(m,i(i({ref:t},u),{},{components:a})):n.createElement(m,i({ref:t},u))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=h;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var c=2;c<l;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},91882:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>c});var n=a(87462),r=(a(67294),a(3905));const l={title:"Install/Upgrade Rancher on a Kubernetes Cluster",description:"Learn how to install Rancher in development and production environments. Read about single node and high availability installation"},i=void 0,o={unversionedId:"pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster",id:"pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster",title:"Install/Upgrade Rancher on a Kubernetes Cluster",description:"Learn how to install Rancher in development and production environments. Read about single node and high availability installation",source:"@site/docs/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster.md",sourceDirName:"pages-for-subheaders",slug:"/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster",permalink:"/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/docs/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster.md",tags:[],version:"current",lastUpdatedAt:1681239575,formattedLastUpdatedAt:"Apr 11, 2023",frontMatter:{title:"Install/Upgrade Rancher on a Kubernetes Cluster",description:"Learn how to install Rancher in development and production environments. Read about single node and high availability installation"},sidebar:"tutorialSidebar",previous:{title:"Feature Flags",permalink:"/getting-started/installation-and-upgrade/installation-references/feature-flags"},next:{title:"Rollbacks",permalink:"/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/rollbacks"}},s={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Kubernetes Cluster",id:"kubernetes-cluster",level:3},{value:"Ingress Controller",id:"ingress-controller",level:3},{value:"CLI Tools",id:"cli-tools",level:3},{value:"Install the Rancher Helm Chart",id:"install-the-rancher-helm-chart",level:2},{value:"1. Add the Helm Chart Repository",id:"1-add-the-helm-chart-repository",level:3},{value:"2. Create a Namespace for Rancher",id:"2-create-a-namespace-for-rancher",level:3},{value:"3. Choose your SSL Configuration",id:"3-choose-your-ssl-configuration",level:3},{value:"4. Install cert-manager",id:"4-install-cert-manager",level:3},{value:"5. Install Rancher with Helm and Your Chosen Certificate Option",id:"5-install-rancher-with-helm-and-your-chosen-certificate-option",level:3},{value:"6. Verify that the Rancher Server is Successfully Deployed",id:"6-verify-that-the-rancher-server-is-successfully-deployed",level:3},{value:"7. Save Your Options",id:"7-save-your-options",level:3},{value:"Finishing Up",id:"finishing-up",level:3}],u=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},p=u("Tabs"),h=u("TabItem"),d={toc:c};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"In this section, you'll learn how to deploy Rancher on a Kubernetes cluster using the Helm CLI."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#kubernetes-cluster"},"Kubernetes Cluster")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ingress-controller"},"Ingress Controller")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#cli-tools"},"CLI Tools"))),(0,r.kt)("h3",{id:"kubernetes-cluster"},"Kubernetes Cluster"),(0,r.kt)("p",null,"Set up the Rancher server's local Kubernetes cluster."),(0,r.kt)("p",null,"Rancher can be installed on any Kubernetes cluster. This cluster can use upstream Kubernetes, or it can use one of Rancher's Kubernetes distributions, or it can be a managed Kubernetes cluster from a provider such as Amazon EKS."),(0,r.kt)("p",null,"For help setting up a Kubernetes cluster, we provide these tutorials:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"RKE:")," For the tutorial to install an RKE Kubernetes cluster, refer to ",(0,r.kt)("a",{parentName:"li",href:"/how-to-guides/new-user-guides/kubernetes-cluster-setup/rke1-for-rancher"},"this page.")," For help setting up the infrastructure for a high-availability RKE cluster, refer to ",(0,r.kt)("a",{parentName:"li",href:"/how-to-guides/new-user-guides/infrastructure-setup/ha-rke1-kubernetes-cluster"},"this page.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"K3s:")," For the tutorial to install a K3s Kubernetes cluster, refer to ",(0,r.kt)("a",{parentName:"li",href:"/how-to-guides/new-user-guides/kubernetes-cluster-setup/k3s-for-rancher"},"this page.")," For help setting up the infrastructure for a high-availability K3s cluster, refer to ",(0,r.kt)("a",{parentName:"li",href:"/how-to-guides/new-user-guides/infrastructure-setup/ha-k3s-kubernetes-cluster"},"this page.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"RKE2:")," For the tutorial to install an RKE2 Kubernetes cluster, refer to ",(0,r.kt)("a",{parentName:"li",href:"/how-to-guides/new-user-guides/kubernetes-cluster-setup/rke2-for-rancher"},"this page.")," For help setting up the infrastructure for a high-availability RKE2 cluster, refer to ",(0,r.kt)("a",{parentName:"li",href:"/how-to-guides/new-user-guides/infrastructure-setup/ha-rke2-kubernetes-cluster"},"this page.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Amazon EKS:")," For details on how to install Rancher on Amazon EKS, including how to install an Ingress controller so that the Rancher server can be accessed, refer to ",(0,r.kt)("a",{parentName:"li",href:"/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/rancher-on-amazon-eks"},"this page.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"AKS:")," For details on how to install Rancher with Azure Kubernetes Service, including how to install an Ingress controller so that the Rancher server can be accessed, refer to ",(0,r.kt)("a",{parentName:"li",href:"/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/rancher-on-aks"},"this page.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"GKE:")," For details on how to install Rancher with Google Kubernetes Engine, including how to install an Ingress controller so that the Rancher server can be accessed, refer to ",(0,r.kt)("a",{parentName:"li",href:"/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/rancher-on-gke"},"this page.")," GKE has two modes of operation when creating a Kubernetes cluster, Autopilot and Standard mode. The cluster configuration for Autopilot mode has restrictions on editing the kube-system namespace. However, Rancher needs to create resources in the kube-system namespace during installation. As a result, you will not be able to install Rancher on a GKE cluster created in Autopilot mode.")),(0,r.kt)("h3",{id:"ingress-controller"},"Ingress Controller"),(0,r.kt)("p",null,"The Rancher UI and API are exposed through an Ingress. This means the Kubernetes cluster that you install Rancher in must contain an Ingress controller."),(0,r.kt)("p",null,"For RKE, RKE2, and K3s installations, you don't have to install the Ingress controller manually because one is installed by default."),(0,r.kt)("p",null,"For distributions that do not include an Ingress Controller by default, like a hosted Kubernetes cluster such as EKS, GKE, or AKS, you have to deploy an Ingress controller first. Note that the Rancher Helm chart does not set an ",(0,r.kt)("inlineCode",{parentName:"p"},"ingressClassName")," on the ingress by default. Because of this, you have to configure the Ingress controller to also watch ingresses without an ",(0,r.kt)("inlineCode",{parentName:"p"},"ingressClassName"),"."),(0,r.kt)("p",null,"Examples are included in the ",(0,r.kt)("strong",{parentName:"p"},"Amazon EKS"),", ",(0,r.kt)("strong",{parentName:"p"},"AKS"),", and ",(0,r.kt)("strong",{parentName:"p"},"GKE")," tutorials above."),(0,r.kt)("h3",{id:"cli-tools"},"CLI Tools"),(0,r.kt)("p",null,"The following CLI tools are required for setting up the Kubernetes cluster. Please make sure these tools are installed and available in your ",(0,r.kt)("inlineCode",{parentName:"p"},"$PATH"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl"},"kubectl")," - Kubernetes command-line tool."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.helm.sh/using_helm/#installing-helm"},"helm")," - Package management for Kubernetes. Refer to the ",(0,r.kt)("a",{parentName:"li",href:"/getting-started/installation-and-upgrade/resources/helm-version-requirements"},"Helm version requirements")," to choose a version of Helm to install Rancher. Refer to the ",(0,r.kt)("a",{parentName:"li",href:"https://helm.sh/docs/intro/install/"},"instructions provided by the Helm project")," for your specific platform.")),(0,r.kt)("h2",{id:"install-the-rancher-helm-chart"},"Install the Rancher Helm Chart"),(0,r.kt)("p",null,"Rancher is installed using the ",(0,r.kt)("a",{parentName:"p",href:"https://helm.sh/"},"Helm")," package manager for Kubernetes. Helm charts provide templating syntax for Kubernetes YAML manifest documents. With Helm, we can create configurable deployments instead of just using static files."),(0,r.kt)("p",null,"For systems without direct internet access, see ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-rancher-ha"},"Air Gap: Kubernetes install"),"."),(0,r.kt)("p",null,"To choose a Rancher version to install, refer to ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/resources/choose-a-rancher-version"},"Choosing a Rancher Version.")),(0,r.kt)("p",null,"To choose a version of Helm to install Rancher with, refer to the ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/resources/helm-version-requirements"},"Helm version requirements")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The installation instructions assume you are using Helm 3.")),(0,r.kt)("p",null,"To set up Rancher,"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#1-add-the-helm-chart-repository"},"Add the Helm chart repository")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#2-create-a-namespace-for-rancher"},"Create a namespace for Rancher")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#3-choose-your-ssl-configuration"},"Choose your SSL configuration")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#4-install-cert-manager"},"Install cert-manager")," (unless you are bringing your own certificates, or TLS will be terminated on a load balancer)"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#5-install-rancher-with-helm-and-your-chosen-certificate-option"},"Install Rancher with Helm and your chosen certificate option")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#6-verify-that-the-rancher-server-is-successfully-deployed"},"Verify that the Rancher server is successfully deployed")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#7-save-your-options"},"Save your options"))),(0,r.kt)("h3",{id:"1-add-the-helm-chart-repository"},"1. Add the Helm Chart Repository"),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"helm repo add")," command to add the Helm chart repository that contains charts to install Rancher. For more information about the repository choices and which is best for your use case, see ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options#helm-chart-repositories"},"Choosing a Version of Rancher"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Latest: Recommended for trying out the newest features",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"helm repo add rancher-latest https://releases.rancher.com/server-charts/latest\n"))),(0,r.kt)("li",{parentName:"ul"},"Stable: Recommended for production environments",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"helm repo add rancher-stable https://releases.rancher.com/server-charts/stable\n"))),(0,r.kt)("li",{parentName:"ul"},"Alpha: Experimental preview of upcoming releases.",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"helm repo add rancher-alpha https://releases.rancher.com/server-charts/alpha\n")),"  Note: Upgrades are not supported to, from, or between Alphas.")),(0,r.kt)("h3",{id:"2-create-a-namespace-for-rancher"},"2. Create a Namespace for Rancher"),(0,r.kt)("p",null,"We'll need to define a Kubernetes namespace where the resources created by the Chart should be installed. This should always be ",(0,r.kt)("inlineCode",{parentName:"p"},"cattle-system"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl create namespace cattle-system\n")),(0,r.kt)("h3",{id:"3-choose-your-ssl-configuration"},"3. Choose your SSL Configuration"),(0,r.kt)("p",null,"The Rancher management server is designed to be secure by default and requires SSL/TLS configuration."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If you want terminate SSL/TLS externally, see ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options#external-tls-termination"},"TLS termination on an External Load Balancer"),".")),(0,r.kt)("p",null,"There are three recommended options for the source of the certificate used for TLS termination at the Rancher server:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Rancher-generated TLS certificate:")," In this case, you will need to install ",(0,r.kt)("inlineCode",{parentName:"li"},"cert-manager")," into the cluster. Rancher utilizes ",(0,r.kt)("inlineCode",{parentName:"li"},"cert-manager")," to issue and maintain its certificates. Rancher will generate a CA certificate of its own, and sign a cert using that CA. ",(0,r.kt)("inlineCode",{parentName:"li"},"cert-manager")," is then responsible for managing that certificate."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Let's Encrypt:")," The Let's Encrypt option also uses ",(0,r.kt)("inlineCode",{parentName:"li"},"cert-manager"),". However, in this case, cert-manager is combined with a special Issuer for Let's Encrypt that performs all actions (including request and validation) necessary for getting a Let's Encrypt issued cert. This configuration uses HTTP validation (",(0,r.kt)("inlineCode",{parentName:"li"},"HTTP-01"),"), so the load balancer must have a public DNS record and be accessible from the internet."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Bring your own certificate:")," This option allows you to bring your own public- or private-CA signed certificate. Rancher will use that certificate to secure websocket and HTTPS traffic. In this case, you must upload this certificate (and associated key) as PEM-encoded files with the name ",(0,r.kt)("inlineCode",{parentName:"li"},"tls.crt")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"tls.key"),". If you are using a private CA, you must also upload that certificate. This is due to the fact that this private CA may not be trusted by your nodes. Rancher will take that CA certificate, and generate a checksum from it, which the various Rancher components will use to validate their connection to Rancher.")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Configuration"),(0,r.kt)("th",{parentName:"tr",align:null},"Helm Chart Option"),(0,r.kt)("th",{parentName:"tr",align:null},"Requires cert-manager"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Rancher Generated Certificates (Default)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ingress.tls.source=rancher")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#4-install-cert-manager"},"yes"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Let\u2019s Encrypt"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ingress.tls.source=letsEncrypt")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#4-install-cert-manager"},"yes"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Certificates from Files"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ingress.tls.source=secret")),(0,r.kt)("td",{parentName:"tr",align:null},"no")))),(0,r.kt)("h3",{id:"4-install-cert-manager"},"4. Install cert-manager"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"New in v2.6.4, cert-manager versions 1.6.2 and 1.7.1 are compatible. We recommend v1.7.x because v 1.6.x will reach end-of-life on March 30, 2022.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You should skip this step if you are bringing your own certificate files (option ",(0,r.kt)("inlineCode",{parentName:"p"},"ingress.tls.source=secret"),"), or if you use ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options#external-tls-termination"},"TLS termination on an external load balancer"),".")),(0,r.kt)("p",null,"This step is only required to use certificates issued by Rancher's generated CA (",(0,r.kt)("inlineCode",{parentName:"p"},"ingress.tls.source=rancher"),") or to request Let's Encrypt issued certificates (",(0,r.kt)("inlineCode",{parentName:"p"},"ingress.tls.source=letsEncrypt"),")."),(0,r.kt)("details",{id:"cert-manager"},(0,r.kt)("summary",null,"Click to Expand"),(0,r.kt)("admonition",{title:"Important:",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Recent changes to cert-manager require an upgrade. If you are upgrading Rancher and using a version of cert-manager older than v0.11.0, please see our ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/resources/upgrade-cert-manager"},"upgrade documentation"),".")),(0,r.kt)("p",null,"These instructions are adapted from the ",(0,r.kt)("a",{parentName:"p",href:"https://cert-manager.io/docs/installation/kubernetes/#installing-with-helm"},"official cert-manager documentation"),"."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"To see options on how to customize the cert-manager install (including for cases where your cluster uses PodSecurityPolicies), see the ",(0,r.kt)("a",{parentName:"p",href:"https://artifacthub.io/packages/helm/cert-manager/cert-manager#configuration"},"cert-manager docs"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# If you have installed the CRDs manually instead of with the `--set installCRDs=true` option added to your Helm install command, you should upgrade your CRD resources before upgrading the Helm chart:\nkubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.11.0/cert-manager.crds.yaml\n\n# Add the Jetstack Helm repository\nhelm repo add jetstack https://charts.jetstack.io\n\n# Update your local Helm chart repository cache\nhelm repo update\n\n# Install the cert-manager Helm chart\nhelm install cert-manager jetstack/cert-manager \\\n  --namespace cert-manager \\\n  --create-namespace \\\n  --version v1.11.0\n")),(0,r.kt)("p",null,"Once you\u2019ve installed cert-manager, you can verify it is deployed correctly by checking the cert-manager namespace for running pods:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl get pods --namespace cert-manager\n\nNAME                                       READY   STATUS    RESTARTS   AGE\ncert-manager-5c6866597-zw7kh               1/1     Running   0          2m\ncert-manager-cainjector-577f6d9fd7-tr77l   1/1     Running   0          2m\ncert-manager-webhook-787858fcdb-nlzsq      1/1     Running   0          2m\n"))),(0,r.kt)("h3",{id:"5-install-rancher-with-helm-and-your-chosen-certificate-option"},"5. Install Rancher with Helm and Your Chosen Certificate Option"),(0,r.kt)("p",null,"The exact command to install Rancher differs depending on the certificate configuration."),(0,r.kt)("p",null,"However, irrespective of the certificate configuration, the name of the Rancher installation in the ",(0,r.kt)("inlineCode",{parentName:"p"},"cattle-system")," namespace should always be ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher"),"."),(0,r.kt)("admonition",{title:"Testing and Development:",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"This final command to install Rancher requires a domain name that forwards traffic to Rancher. If you are using the Helm CLI to set up a proof-of-concept, you can use a fake domain name when passing the ",(0,r.kt)("inlineCode",{parentName:"p"},"hostname")," option. An example of a fake domain name would be ",(0,r.kt)("inlineCode",{parentName:"p"},"<IP_OF_LINUX_NODE>.sslip.io"),", which would expose Rancher on an IP where it is running. Production installs would require a real domain name.")),(0,r.kt)(p,{mdxType:"Tabs"},(0,r.kt)(h,{value:"Rancher-generated Certificates",mdxType:"TabItem"},(0,r.kt)("p",null,"The default is for Rancher to generate a CA and uses ",(0,r.kt)("inlineCode",{parentName:"p"},"cert-manager")," to issue the certificate for access to the Rancher server interface."),(0,r.kt)("p",null,"Because ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher")," is the default option for ",(0,r.kt)("inlineCode",{parentName:"p"},"ingress.tls.source"),", we are not specifying ",(0,r.kt)("inlineCode",{parentName:"p"},"ingress.tls.source")," when running the ",(0,r.kt)("inlineCode",{parentName:"p"},"helm install")," command."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set the ",(0,r.kt)("inlineCode",{parentName:"li"},"hostname")," to the DNS name you pointed at your load balancer."),(0,r.kt)("li",{parentName:"ul"},"Set the ",(0,r.kt)("inlineCode",{parentName:"li"},"bootstrapPassword")," to something unique for the ",(0,r.kt)("inlineCode",{parentName:"li"},"admin")," user."),(0,r.kt)("li",{parentName:"ul"},"To install a specific Rancher version, use the ",(0,r.kt)("inlineCode",{parentName:"li"},"--version")," flag, example: ",(0,r.kt)("inlineCode",{parentName:"li"},"--version 2.3.6"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"helm install rancher rancher-<CHART_REPO>/rancher \\\n  --namespace cattle-system \\\n  --set hostname=rancher.my.org \\\n  --set bootstrapPassword=admin\n")),(0,r.kt)("p",null,"If you are installing an alpha version, Helm requires adding the ",(0,r.kt)("inlineCode",{parentName:"p"},"--devel")," option to the install command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"helm install rancher rancher-alpha/rancher --devel\n")),(0,r.kt)("p",null,"Wait for Rancher to be rolled out:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'kubectl -n cattle-system rollout status deploy/rancher\nWaiting for deployment "rancher" rollout to finish: 0 of 3 updated replicas are available...\ndeployment "rancher" successfully rolled out\n'))),(0,r.kt)(h,{value:"Let's Encrypt",mdxType:"TabItem"},(0,r.kt)("p",null,"This option uses ",(0,r.kt)("inlineCode",{parentName:"p"},"cert-manager")," to automatically request and renew ",(0,r.kt)("a",{parentName:"p",href:"https://letsencrypt.org/"},"Let's Encrypt")," certificates. This is a free service that provides you with a valid certificate as Let's Encrypt is a trusted CA."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"You need to have port 80 open as the HTTP-01 challenge can only be done on port 80.")),(0,r.kt)("p",null,"In the following command,"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hostname")," is set to the public DNS record,"),(0,r.kt)("li",{parentName:"ul"},"Set the ",(0,r.kt)("inlineCode",{parentName:"li"},"bootstrapPassword")," to something unique for the ",(0,r.kt)("inlineCode",{parentName:"li"},"admin")," user."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ingress.tls.source")," is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"letsEncrypt")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"letsEncrypt.email")," is set to the email address used for communication about your certificate (for example, expiry notices)"),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"letsEncrypt.ingress.class")," to whatever your ingress controller is, e.g., ",(0,r.kt)("inlineCode",{parentName:"li"},"traefik"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"nginx"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"haproxy"),", etc.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"helm install rancher rancher-<CHART_REPO>/rancher \\\n  --namespace cattle-system \\\n  --set hostname=rancher.my.org \\\n  --set bootstrapPassword=admin \\\n  --set ingress.tls.source=letsEncrypt \\\n  --set letsEncrypt.email=me@example.org \\\n  --set letsEncrypt.ingress.class=nginx\n")),(0,r.kt)("p",null,"If you are installing an alpha version, Helm requires adding the ",(0,r.kt)("inlineCode",{parentName:"p"},"--devel")," option to the install command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"helm install rancher rancher-alpha/rancher --devel\n")),(0,r.kt)("p",null,"Wait for Rancher to be rolled out:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'kubectl -n cattle-system rollout status deploy/rancher\nWaiting for deployment "rancher" rollout to finish: 0 of 3 updated replicas are available...\ndeployment "rancher" successfully rolled out\n'))),(0,r.kt)(h,{value:"Certificates from Files",mdxType:"TabItem"},"In this option, Kubernetes secrets are created from your own certificates for Rancher to use.",(0,r.kt)("p",null,"When you run this command, the ",(0,r.kt)("inlineCode",{parentName:"p"},"hostname")," option must match the ",(0,r.kt)("inlineCode",{parentName:"p"},"Common Name")," or a ",(0,r.kt)("inlineCode",{parentName:"p"},"Subject Alternative Names")," entry in the server certificate or the Ingress controller will fail to configure correctly."),(0,r.kt)("p",null,"Although an entry in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Subject Alternative Names")," is technically required, having a matching ",(0,r.kt)("inlineCode",{parentName:"p"},"Common Name")," maximizes compatibility with older browsers and applications."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If you want to check if your certificates are correct, see ",(0,r.kt)("a",{parentName:"p",href:"/faq/technical-items#how-do-i-check-common-name-and-subject-alternative-names-in-my-server-certificate"},"How do I check Common Name and Subject Alternative Names in my server certificate?"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set the ",(0,r.kt)("inlineCode",{parentName:"li"},"hostname"),"."),(0,r.kt)("li",{parentName:"ul"},"Set the ",(0,r.kt)("inlineCode",{parentName:"li"},"bootstrapPassword")," to something unique for the ",(0,r.kt)("inlineCode",{parentName:"li"},"admin")," user."),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"ingress.tls.source")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"secret"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"helm install rancher rancher-<CHART_REPO>/rancher \\\n  --namespace cattle-system \\\n  --set hostname=rancher.my.org \\\n  --set bootstrapPassword=admin \\\n  --set ingress.tls.source=secret\n")),(0,r.kt)("p",null,"If you are installing an alpha version, Helm requires adding the ",(0,r.kt)("inlineCode",{parentName:"p"},"--devel")," option to the install command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"helm install rancher rancher-alpha/rancher --devel\n")),(0,r.kt)("p",null,"If you are using a Private CA signed certificate , add ",(0,r.kt)("inlineCode",{parentName:"p"},"--set privateCA=true")," to the command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"helm install rancher rancher-<CHART_REPO>/rancher \\\n  --namespace cattle-system \\\n  --set hostname=rancher.my.org \\\n  --set bootstrapPassword=admin \\\n  --set ingress.tls.source=secret \\\n  --set privateCA=true\n")),(0,r.kt)("p",null,"Now that Rancher is deployed, see ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/resources/add-tls-secrets"},"Adding TLS Secrets")," to publish the certificate files so Rancher and the Ingress controller can use them."))),(0,r.kt)("p",null,"The Rancher chart configuration has many options for customizing the installation to suit your specific environment. Here are some common advanced scenarios."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options#http-proxy"},"HTTP Proxy")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options#private-registry-and-air-gap-installs"},"Private Container Image Registry")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options#external-tls-termination"},"TLS Termination on an External Load Balancer"))),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options"},"Chart Options")," for the full list of options."),(0,r.kt)("h3",{id:"6-verify-that-the-rancher-server-is-successfully-deployed"},"6. Verify that the Rancher Server is Successfully Deployed"),(0,r.kt)("p",null,"After adding the secrets, check if Rancher was rolled out successfully:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'kubectl -n cattle-system rollout status deploy/rancher\nWaiting for deployment "rancher" rollout to finish: 0 of 3 updated replicas are available...\ndeployment "rancher" successfully rolled out\n')),(0,r.kt)("p",null,"If you see the following error: ",(0,r.kt)("inlineCode",{parentName:"p"},'error: deployment "rancher" exceeded its progress deadline'),", you can check the status of the deployment by running the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl -n cattle-system get deploy rancher\nNAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nrancher   3         3         3            3           3m\n")),(0,r.kt)("p",null,"It should show the same count for ",(0,r.kt)("inlineCode",{parentName:"p"},"DESIRED")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"AVAILABLE"),"."),(0,r.kt)("h3",{id:"7-save-your-options"},"7. Save Your Options"),(0,r.kt)("p",null,"Make sure you save the ",(0,r.kt)("inlineCode",{parentName:"p"},"--set")," options you used. You will need to use the same options when you upgrade Rancher to new versions with Helm."),(0,r.kt)("h3",{id:"finishing-up"},"Finishing Up"),(0,r.kt)("p",null,"That's it. You should have a functional Rancher server."),(0,r.kt)("p",null,"In a web browser, go to the DNS name that forwards traffic to your load balancer. Then you should be greeted by the colorful login page."),(0,r.kt)("p",null,"Doesn't work? Take a look at the ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/troubleshooting"},"Troubleshooting")," Page"))}m.isMDXComponent=!0}}]);